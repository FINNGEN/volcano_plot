{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\keppo\\\\Desktop\\\\react_folder\\\\lavaa\\\\src\\\\lavaa.js\",\n    _s = $RefreshSig$();\n\nimport './style.css';\nimport React, { useState, useEffect } from 'react';\nimport * as d3module from 'd3';\nimport { tip as d3tip } from \"d3-v6-tip\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst d3 = { ...d3module,\n  tip: d3tip\n};\n\nfunction Lavaa(props) {\n  _s();\n\n  let [selection, setSelection] = useState([]);\n  let [ready, setReady] = useState(false); //set the initial state to be not ready\n  //console.log(props.dataprop);\n\n  const data = props.dataprop;\n  useEffect(() => {\n    if (!ready) {\n      //if not ready, then:\n      setReady(true); /////////////////////--file upload by Nicola, disabled for this component--///////////////////////////\n\n      /*const fileUpload = document.getElementById(\"data-file\")\r\n      fileUpload.onchange = () => {\r\n          const reader = new FileReader();\r\n          const dataFile = fileUpload.files[0]\r\n          var fileInput = document.getElementById('data-file');\r\n          var filename = fileInput.files[0].name;\r\n          reader.readAsText(dataFile, \"UTF-8\")\r\n          reader.onload = () => {\r\n            const data = reader.result.split(\"\\r\\n\").slice(1).map(e => {\r\n              const values = e.split(\"\\t\");\r\n              //console.log(parseFloat(values[3]));\r\n              return {\r\n                \"phenocode\": values[0],\r\n                \"phenostring\": values[1],\r\n                \"category\": values[2],\r\n                \"pval\": parseFloat(values[3].replace(\",\",\".\")),\r\n                \"beta\": parseFloat(values[4].replace(\",\",\".\")),\r\n                \"maf\": parseFloat(values[5]),\r\n                \"maf_case\": parseFloat(values[6]),\r\n                \"maf_control\": parseFloat(values[7]),\r\n                \"n_case\": parseFloat(values[8]),\r\n                \"n_control\": parseFloat(values[9]),\r\n                \"pip\": parseFloat(values[10]?.replace(\",\",\".\")|| 0),\r\n              }\r\n            }).filter(e => e.pval < 1);\r\n            d3.select(\"#chart\").select(\"svg\").remove();\r\n            volcano(data)\r\n              //interactiveLabels();\r\n          }\r\n        } //end of onchange*/\n      /////////////////////--file upload for start screen, no longer used--///////////////////////////\n\n      /*const fileUploadStart = document.getElementById(\"data-file-start\")\r\n      fileUploadStart.onchange = () => {\r\n          const reader = new FileReader();\r\n          const dataFile = fileUploadStart.files[0]\r\n          var fileInput = document.getElementById('data-file-start');\r\n          var filename = fileInput.files[0].name;\r\n          reader.readAsText(dataFile, \"UTF-8\")\r\n          reader.onload = () => {\r\n            const data = reader.result.split(\"\\r\\n\").slice(1).map(e => {\r\n              const values = e.split(\"\\t\");\r\n              return {\r\n                \"phenocode\": values[0],\r\n                \"phenostring\": values[1],\r\n                \"category\": values[2],\r\n                \"pval\": parseFloat(values[3].replace(\",\",\".\")),\r\n                \"beta\": parseFloat(values[4].replace(\",\",\".\")),\r\n                \"maf\": parseFloat(values[5]),\r\n                \"maf_case\": parseFloat(values[6]),\r\n                \"maf_control\": parseFloat(values[7]),\r\n                \"n_case\": parseFloat(values[8]),\r\n                \"n_control\": parseFloat(values[9]),\r\n                \"pip\": parseFloat(values[10]?.replace(\",\",\".\")|| 0),\r\n              }\r\n            }).filter(e => e.pval < 1);\r\n            d3.select(\"#chart\").select(\"svg\").remove();\r\n            volcano(data)\r\n              //interactiveLabels();\r\n          }\r\n        } //end of onchange*/\n      //show zoom state buttons\n\n      function showBtn() {\n        var back = document.getElementById(\"button_back\");\n        back.style.display = \"block\";\n        var showZoomHull = document.getElementById(\"ZoomHull\");\n        showZoomHull.style.display = \"block\";\n      } //hide zoom state buttons\n\n\n      function hideBtn() {\n        var hideBack = document.getElementById(\"button_back\");\n        hideBack.style.display = \"none\";\n        var hideZoomHull = document.getElementById(\"ZoomHull\");\n        hideZoomHull.style.display = \"none\";\n      } //hide normal view buttons on zoom\n\n\n      function hideBtns() {\n        var hide = document.getElementById(\"hideThese\");\n        hide.style.display = \"none\";\n        var hideHull = document.getElementById(\"hullCheckboxDiv\");\n        hideHull.style.display = \"none\";\n        var hideSig = document.getElementById(\"significanceCheckboxDiv\");\n        hideSig.style.display = \"none\";\n        var hidePip = document.getElementById(\"pipCheckboxDiv\");\n        hidePip.style.display = \"none\";\n      } //show normal view buttons on zoom\n\n\n      function showBtnBlock() {\n        var show = document.getElementById(\"hideThese\");\n        show.style.display = \"block\";\n        var showHull = document.getElementById(\"hullCheckboxDiv\");\n        showHull.style.display = \"block\";\n        var showSig = document.getElementById(\"significanceCheckboxDiv\");\n        showSig.style.display = \"block\";\n        var showPip = document.getElementById(\"pipCheckboxDiv\");\n        showPip.style.display = \"block\";\n      } //hide download image button, use before image is shown\n\n\n      function showImgDownload() {\n        var show = document.getElementById('downloadImg-block');\n        show.style.display = 'block';\n      } //show zoom clear selection button\n\n\n      function showZoomClear() {\n        var hide = document.getElementById('btn-block-toggle');\n        hide.style.display = 'none';\n        var show = document.getElementById('btn-block-2');\n        show.style.display = 'block';\n      } //hide zoom clear selection button\n\n\n      function hideZoomClear() {\n        var show = document.getElementById('btn-block-toggle');\n        show.style.display = 'block';\n        var hide = document.getElementById('btn-block-2');\n        hide.style.display = 'none';\n      } //toggle download button\n\n\n      function myToggle() {\n        var x = document.getElementById(\"download-options\");\n\n        if (x.style.display === \"none\") {\n          x.style.display = \"block\";\n        } else {\n          x.style.display = \"none\";\n        }\n      } //show legends\n\n\n      function showLegends() {\n        var showL = document.getElementById('labels-block');\n        showL.style.opacity = '1';\n      }\n\n      function resetDiv() {\n        var collapsed = document.getElementById('labels-block');\n        collapsed.style.marginRight = '0vw';\n        collapsed.style.width = '5vw';\n        var showBtn = document.getElementById('button_legend');\n        showBtn.style.display = 'block';\n        var hideCollapseBtn = document.getElementById('buttonCollapse');\n        hideCollapseBtn.style.display = 'none'; // Get a NodeList of all elements\n\n        const legendTexts = document.querySelectorAll('.label'); // Change the visibility attr of multiple elements with a loop\n\n        legendTexts.forEach(element => {\n          element.style.visibility = 'hidden';\n        });\n      }\n      /*function hideStartView(){\r\n        var startView = document.getElementById('start');\r\n        var showChart = document.getElementById('afterStart');\r\n        startView.style.display = \"none\";\r\n        showChart.style.display = \"block\";\r\n      }*/\n\n\n      function downloadCsvZoom() {\n        //function to remove duplicate values from the array\n        function removeDuplicates3(selection4) {\n          return selection4.filter((value, index) => selection4.indexOf(value) === index);\n        } //make the header\n\n\n        var data_export_csv_header = Object.keys(selection4[0]).join(),\n            //gets data keys as strings\n        rows = removeDuplicates3(selection4); //this is the core\n\n        var data_export_csv_rows = rows.map(function (el) {\n          return Object.values(el).join();\n        }).join('\\n');\n        var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\n\n        /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\n\n        var blob = new Blob([data_export_csv]);\n\n        if (window.navigator.msSaveOrOpenBlob) {\n          window.navigator.msSaveBlob(blob, \"tableData.csv\");\n        } else {\n          var a = window.document.createElement(\"a\"); //empty element(link)\n\n          a.href = window.URL.createObjectURL(blob, {\n            type: \"text/plain\"\n          }); //console.log(a.href, 'ciao');\n\n          a.download = \"tableData.csv\";\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n        }\n      } /////////////////////////////////////////////////////\n      //////----the main function starts here---///////////\n      /////////////////////////////////////////////////////\n\n\n      function volcano() {\n        const selection2 = []; //an empty array where we can push brushed data\n\n        const selection3 = []; //an empty array where we can push brushed data\n\n        const selection4 = []; //an empty array where we can push brushed data\n\n        function removeText() {\n          //remove texts tagged with 'info' class\n          d3.selectAll('p.info').remove();\n        }\n\n        function removeBrush2() {\n          //remove brush selection\n          selection3.length = 0;\n        }\n\n        function removeBrush3() {\n          //remove brush selection\n          selection4.length = 0;\n        } //hideStartView();\n\n\n        showImgDownload();\n        hideDownloadOptions();\n        showLegends();\n        d3.select('.h2').remove();\n        d3.select('#gLegContainer').remove();\n        d3.select('#gLegContainer2').remove();\n\n        document.getElementById('button_legend').onclick = function () {\n          return expandDiv();\n        };\n\n        document.getElementById('hullCheckbox').onclick = function () {\n          if (this.checked) {\n            if (document.getElementById('significanceCheckbox').checked) {\n              return showHull2();\n            } else {\n              return showHull();\n            }\n          } else {\n            return hideHull();\n          }\n        };\n\n        document.getElementById('hullCheckboxZoom').onclick = function () {\n          if (this.checked) {\n            return showHull3();\n          } else {\n            return hideHull();\n          }\n        }; //show and hide convex hull with a checkbox\n\n\n        document.getElementById('significanceCheckbox').onclick = function () {\n          if (this.checked) {\n            return redrawScale(); // show significant ones\n          } else {\n            return overView(); //return to normal state\n          }\n        }; //show and hide pip with a checkbox\n\n\n        document.getElementById('pipCheckbox').onclick = function () {\n          if (this.checked) {\n            if (document.getElementById('significanceCheckbox').checked) {\n              return showPip2();\n            } else {\n              return showPip();\n            } // show nodes with high pip-values\n\n          } else {\n            return hidePip(); //hide pip indication\n          }\n        };\n\n        function expandDiv() {\n          var expanded = document.getElementById('labels-block');\n          expanded.style.marginRight = '-50vw';\n          expanded.style.width = '50vw';\n          var hideBtn = document.getElementById('button_legend');\n          hideBtn.style.display = 'none';\n          var showCollapseBtn = document.getElementById('buttonCollapse');\n          showCollapseBtn.style.display = 'block';\n\n          document.getElementById('buttonCollapse').onclick = function () {\n            return collapseDiv();\n          }; // Get a NodeList of all elements\n\n\n          const legendTexts = document.querySelectorAll('.label'); // Change the visibility attr of multiple elements with a loop\n\n          legendTexts.forEach(element => {\n            element.style.visibility = 'visible';\n          });\n\n          function collapseDiv() {\n            var collapsed = document.getElementById('labels-block');\n            collapsed.style.marginRight = '0vw';\n            collapsed.style.width = '5vw';\n            var showBtn = document.getElementById('button_legend');\n            showBtn.style.display = 'block';\n            var hideCollapseBtn = document.getElementById('buttonCollapse');\n            hideCollapseBtn.style.display = 'none'; // Get a NodeList of all elements\n\n            const legendTexts = document.querySelectorAll('.label'); // Change the visibility attr of multiple elements with a loop\n\n            legendTexts.forEach(element => {\n              element.style.visibility = 'hidden';\n            });\n          }\n        } //end of expand-collapse\n\n\n        function goBack() {\n          overView();\n          showBtnBlock();\n        }\n\n        function removeBrush() {\n          //remove brush selection\n          selection2.length = 0;\n        }\n\n        function removeBrush2() {\n          //remove brush selection\n          selection3.length = 0;\n        }\n\n        function removeBrush3() {\n          //remove brush selection\n          selection4.length = 0;\n        }\n\n        function clearSelections() {\n          removeText();\n          removeBrush();\n          removeBrush2();\n          removeBrush3();\n        }\n\n        document.getElementById('button_styled').onclick = function () {\n          return clearSelections();\n        };\n\n        document.getElementById('button_styled-2').onclick = function () {\n          return clearSelections();\n        };\n\n        document.getElementById('button_back').onclick = function () {\n          return goBack();\n        }; //setting values for the viewBox\n\n\n        const heightValue = 330;\n        const widthValue = 320; //Create SVG and padding for the chart\n\n        /*var svg = d3.select(\"#chartInner\").select(\"svg\").nodes.length === 0 ? \r\n          d3.select(\"#chartInner\")\r\n            .append(\"svg\")\r\n            .attr(\"viewBox\", `2 -10 320 330`)\r\n            .attr(\"stroke-width\", \"0.3\")\r\n           : d3.select(\"#chartInner\")\r\n           .select(\"svg\");*/\n\n        /*if(d3.select(\"#chartInner\").select(\"svg\").nodes().length === 0){\r\n         var svg = d3.select(\"#chartInner\")\r\n         .append(\"svg\")\r\n         .attr(\"viewBox\", `2 -10 320 330`)\r\n         .attr(\"stroke-width\", \"0.3\");\r\n        } else {\r\n         var svg = d3.select(\"#chartInner\")\r\n         .select(\"svg\");\r\n        }*/\n\n        const svg = d3.select(\"#chartInner\").append(\"svg\").attr(\"viewBox\", `2 -10 320 330`).attr(\"stroke-width\", \"0.3\");\n        const margin = {\n          top: 50,\n          bottom: 50,\n          left: 40,\n          right: 2\n        };\n        const chart = svg.append(\"g\").attr(\"transform\", `translate(${margin.left},0)`);\n        const width = 320 - margin.left - margin.right; //width of the chart\n\n        const height = 330 - margin.top - margin.bottom; //height of the chart\n        //create an svg for legend container since it's outside of the chart div\n\n        const svg2 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer'); //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\n\n        const legendBlockVar = svg2.append('g').attr(\"transform\", `translate(${margin.right},0)`);\n        const f = d3.format(\".1f\"); //Initiating Y- and color-scales\n\n        var yScale = d3.scaleLog();\n        var yScale2 = d3.scaleLog();\n        var yScale3 = d3.scaleLog();\n        const colorScale = d3.scaleOrdinal().range(d3.schemeTableau10);\n\n        const colorValue = d => d.category; //Color value by category\n\n\n        const colorScale2 = d3.scaleOrdinal().range(d3.schemeTableau10); //getting max and min y (p-value) values\n\n        var max = d3.max(data, function (d) {\n          return d.pval;\n        });\n        var min = d3.min(data, function (d) {\n          return d.pval;\n        }); //max for the case numbers\n\n        var maxCases = d3.max(data, function (d) {\n          return d.n_case;\n        }); //create two Yscales with different ranges\n\n        yScale.domain([min, max]).range([0, height]).nice();\n        yScale2.domain([0.0000001, max + 5]) //padding to the bottom\n        .range([200, 250]); //extra y-scale for showing only significant values\n\n        yScale3.domain([min, 0.0000001]).range([0, height]).nice(); //getting max and min x (beta) values\n\n        var betaMax = d3.max(data, function (d) {\n          return d.beta;\n        });\n        var betaMin = d3.min(data, function (d) {\n          return d.beta;\n        }); //get min and max beta from significant ones\n\n        var betaMax2 = d3.max(data, function (d) {\n          if (d.pval <= 0.0000001) {\n            return d.beta;\n          }\n        });\n        var betaMin2 = d3.min(data, function (d) {\n          if (d.pval <= 0.0000001) {\n            return d.beta;\n          }\n        });\n        var biggerBeta = d3.max(data, function (d) {\n          if (betaMax > betaMin * -1) {\n            return betaMax;\n          } else {\n            return betaMin * -1;\n          }\n        }); //create x-scale\n\n        var xScale = d3.scaleLinear().domain([biggerBeta * -1 - 0.1, biggerBeta + 0.1]) //make x-scale symmetrical\n        .range([0, width]);\n        var xScale2 = d3.scaleLinear().domain([betaMin2 - 0.1, betaMax2 + 0.1]).range([0, width]); //initializing square root scale for scaling datapoint size\n\n        var sqrtScale = d3.scaleSqrt().domain([0, maxCases]).range([2, 10]); //only allow a slight change in values since variation is huge\n        //var fileInput = document.getElementById('data-file');\n        //var filename = fileInput.files[0].name;\n        //var headline = d3.select('#headline-block')\n        //var newStr = filename.replace(/_/g, \":\");\n\n        /*headline.append('text').attr(\"x\", 0).attr(\"y\", 0).attr('class', 'h2').text(function(d) {\r\n          return newStr.split('.')[0] //get the filename without the extension\r\n            .slice(0, -23)\r\n        });*/\n        //enable the enter-zoom in first state\n        //trigger a function with enter. https://stackoverflow.com/questions/40252637/keypress-trigger-a-function-if-specific-pressed\n\n        function checkKey(e) {\n          var key = e.which || e.keyCode;\n          if (key === 13) zooming();\n          showBtn();\n          hideBtns();\n          removeText(); //on enter zoom, remove old selection text and switch button view\n        }\n\n        document.addEventListener(\"keypress\", checkKey); //Append the X Axis\n\n        chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5).tickSize(-height)) //adjust tick labels\n        .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5); //Append the Y Axis\n\n        chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale).ticks(5).tickSize(-width)) //adjust tick labels\n        .selectAll('text').attr('class', 'yTickLabel').style('font-size', '0.5em').style('opacity', 0.5).text(function (d) {\n          return d === 1 ? d : d.toExponential().replace('1e-', '');\n        }); //add labels\n\n        chart.append(\"text\").text(\"-log10 p-value\").attr(\"x\", 20).attr(\"y\", height / 1.8).attr(\"transform\", \"translate(-150,150) rotate(-90)\").attr('class', 'axisLabel').style('font-size', '0.4em').style('font-family', 'sans-serif');\n        chart.append(\"text\").attr(\"x\", width / 2).attr(\"y\", height * 1.08).attr('class', 'axisLabel').style(\"text-anchor\", \"middle\").text(\"beta value\").style('font-size', '0.4em').style('font-family', 'sans-serif'); //lightly color the zero side of the x-axis\n\n        chart.append('rect').attr(\"height\", height).attr('width', xScale(0)).attr(\"fill\", \"lightgray\").attr(\"opacity\", 0.2);\n        d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5);\n        chart.append('line').attr(\"x1\", 0).attr(\"y1\", yScale(0.0000001)).attr(\"x2\", width).attr(\"y2\", yScale(0.0000001)).style(\"stroke\", 'grey').style(\"stroke-dasharray\", \"3, 3\").style(\"stroke-width\", 0.5); //set up the tooltip\n\n        var tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-5, 0]).html((event, d) => {\n          return d.category + '<br>' + '<br>' + d.phenostring + '<br>' + '<br>' + \"p-value: \" + d.pval + \"<br>\" + \"beta value: \" + d.beta + '<br>' + \"cases / controls: \" + d.n_case + ' / ' + d.n_control + '<br>' + 'pip: ' + d.pip;\n        });\n        svg.call(tip); ///////////////////--bigger background dots--//////////////////////\n\n        var g = svg.append('g') //make a new g element to which we append circles\n        .attr(\"id\", \"dataPoints\").selectAll('g').data(data).enter().append('g');\n        g.append('circle').attr(\"cx\", function (d) {\n          return xScale(d.beta) + 40;\n        }) //+margin-left amount\n        .attr(\"cy\", function (d) {\n          return yScale(d.pval);\n        }).attr('r', d => sqrtScale(d.n_case)).style('pointer-events', 'none') //disable hover effects\n        .style('opacity', function (d) {\n          if (d.pval >= 0.0000001) {\n            return 'opacity', 0.1;\n          } else {\n            return 'opacity', 0.2;\n          }\n        }).attr('fill', d => colorScale(colorValue(d))); //color by category\n        ///////////////////////////--add dots--////////////////////////////\n\n        g.append('circle').attr(\"cx\", function (d) {\n          return xScale(d.beta) + 40;\n        }) //+margin-left amount\n        .attr(\"cy\", function (d) {\n          return yScale(d.pval);\n        }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', function (d) {\n          if (d.pval >= 0.0000001) {\n            return 'opacity', 0.4;\n          } else {\n            return 'opacity', 1;\n          }\n        }).attr('fill', d => colorScale(colorValue(d))) ////////////////////--hover events--////////////////////////////////\n        //tooltip\n        .on('mouseover.tip', tip.show, function () {\n          d3.select(this).transition().duration('100');\n        }).on('mouseout.tip', tip.hide) //highlight color\n        .on('mouseover.color', function () {\n          d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n        }).on('mouseout.color', function () {\n          d3.select(this).transition().duration('200').style('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.4;\n            } else {\n              return 'opacity', 1;\n            }\n          }).attr('r', 2);\n        }) //add labels on click, mostly credit to Nicola\n        .on(\"click\", function (e, d) {\n          var x = parseFloat(d3.select(this).attr(\"cx\")),\n              y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n          let format = d3.format(',');\n          let formattedCases = format(d.n_case);\n          const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n          label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n          label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n          label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n          .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n        }) //reset labels on double-click\n        .on('dblclick', function () {\n          labelLayer.selectAll(\"*\").remove();\n        }); //////////////////////--labels--//////////////////////////////////////\n\n        var newData = data.filter(d => d.pval <= 0.0000001); //categoryData = data.filter(d => d.category == 'Diseases marked as autimmune origin')\n        //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\n\n        const unique = [];\n        newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x)); //Initialize data\n\n        var chartData = unique; //Initialize legend\n\n        var clicked = \"\";\n        var legendItemSize = 8;\n        var legendSpacing = 20;\n        var xOffset = 10;\n        var yOffset = 10; //var labelsBlock = d3.select('#labels-block')\n\n        var gLeg = legendBlockVar.selectAll('g').data(chartData).enter().append('g');\n        gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\n          var x = xOffset;\n          var y = yOffset + (legendItemSize + legendSpacing) * i;\n          return `translate(${x}, ${y})`;\n        });\n        gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category); ////////////////////////////////////////////////////////////////////\n        //attaching click to the legend text for now\n\n        gLeg.on(\"mouseover.legend\", function (d) {\n          d3.selectAll('.newCircleCenter').remove();\n          var legendText = this.textContent; //get the text of the legend in a variable\n\n          var HighlightData = data.filter(d => d.category == legendText); //get the data objects associated with the legend\n\n          d3.selectAll('.circleCenter').style('opacity', 0.1); //on any click set all centers to hidemode\n          //.style('pointer-events', 'none')\n          //Append new circles\n\n          var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g');\n          g.append('circle').attr(\"cx\", function (d) {\n            return xScale(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale(d.pval);\n          }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d))) //tooltip\n          .on('mouseover.tip', tip.show, function () {\n            d3.select(this).transition().duration('100');\n          }).on('mouseout.tip', tip.hide) //highlight color\n          .on('mouseover.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n          }).on('mouseout.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2);\n          }) //add labels on click, mostly credit to Nicola\n          .on(\"click\", function (e, d) {\n            var x = parseFloat(d3.select(this).attr(\"cx\")),\n                y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n            let format = d3.format(',');\n            let formattedCases = format(d.n_case);\n            const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n            label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n            .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n          }) //reset labels on double-click\n          .on('dblclick', function () {\n            labelLayer.selectAll(\"*\").remove();\n          }); //highlight selected gLeg group\n\n          d3.selectAll(gLeg).style('opacity', 0.5);\n          d3.select(this).style('opacity', 1);\n        }); //end of click\n        //double-click anywhere on the labels block\n\n        var labelsBlock = d3.select('#labels-block');\n        labelsBlock.on('mouseout.legend', function (d) {\n          //reset circlecenter opacity\n          d3.selectAll('.circleCenter').style('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.4;\n            } else {\n              return 'opacity', 1;\n            }\n          }); //remove highlights\n\n          d3.selectAll('.newCircleCenter').remove(); //legend items back to full opacity\n\n          d3.selectAll(gLeg).style('opacity', 1);\n        }); //////////////////////--brushing--/////////////////////////\n        //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\n        //const selection2 = [];//an empty array where we can push data\n\n        const brush = d3.brush().extent([[0, 0], [width, height]]); //stay within the chart and above the significance\n        //attach the brush to the chart\n\n        const gBrush = chart.append('g').attr('class', 'brush').call(brush); //column setup for the brushed data\n\n        const table = d3.select('#info-column');\n        const categoryCol = d3.select('#category');\n        const phenoCol = d3.select('#phenotype');\n        const pvalCol = d3.select('#pval');\n        const betaCol = d3.select('#beta');\n        const caseCol = d3.select('#case-control'); //brush event inside the first state\n\n        brush.on('end', function (event, d) {\n          const selection = event.selection; //the scope of the brush\n\n          d3.selectAll('circle').each(function (d) {\n            //go through the points\n            if (selection && yScale(d.pval) > selection[0][1] && yScale(d.pval) < selection[1][1] && xScale(d.beta) > selection[0][0] && xScale(d.beta) < selection[1][0]) {\n              selection2.push(d); //push data to the empty array\n            }\n          }); //function to remove duplicate values from the array\n\n          function removeDuplicates(selection2) {\n            return selection2.filter((value, index) => selection2.indexOf(value) === index);\n          } //console.log(removeDuplicates(selection2))\n\n\n          categoryCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').html(function (d) {\n            return d.category;\n          });\n          phenoCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n            return i * 12;\n          }).html(function (d) {\n            return d.phenostring;\n          });\n          pvalCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n            return i * 12;\n          }).html(function (d) {\n            return d.pval;\n          });\n          betaCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n            return i * 12;\n          }).html(function (d) {\n            return d.beta;\n          });\n          caseCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n            return i * 12;\n          }).html(function (d) {\n            return d.n_case + ' / ' + d.n_control;\n          });\n          setSelection(selection2);\n        }); /////////////////////--csv download--///////////////////////////\n\n        function downloadCsv() {\n          //function to remove duplicate values from the array\n          function removeDuplicates(selection2) {\n            return selection2.filter((value, index) => selection2.indexOf(value) === index);\n          } //make the header\n\n\n          var data_export_csv_header = Object.keys(selection2[0]).join(),\n              //gets data keys as strings\n          rows = removeDuplicates(selection2); //this is the core\n\n          var data_export_csv_rows = rows.map(function (el) {\n            return Object.values(el).join();\n          }).join('\\n');\n          var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\n\n          /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\n\n          var blob = new Blob([data_export_csv]);\n\n          if (window.navigator.msSaveOrOpenBlob) {\n            window.navigator.msSaveBlob(blob, \"tableData.csv\");\n          } else {\n            var a = window.document.createElement(\"a\"); //empty element(link)\n\n            a.href = window.URL.createObjectURL(blob, {\n              type: \"text/plain\"\n            }); //console.log(a.href, 'ciao');\n\n            a.download = \"tableData.csv\";\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n          }\n        }\n\n        document.getElementById('button_styled_download').onclick = function () {\n          return downloadCsv();\n        }; /////////////////////--convex hull--////////////////////////////////\n\n\n        function showHull() {\n          // wrapped the hull in a function\n          //convex hull code by Nicola\n          var hullPoints = []; //create empty array where to store datapoints\n\n          const groups = d3.groups(data, function (d) {\n            return d.category; //grouping done by categories, returns an array\n          }).filter(function (G) {\n            const groupsize = G[1].filter(function (g) {\n              return g.pval < 0.0000001;\n            }).length;\n\n            if (groupsize > 0) {\n              return G;\n            }\n          });\n          groups.forEach(e => {\n            const group = e[1];\n            group.forEach((d, i) => {\n              hullPoints[i] = [xScale(d.beta) + 40, yScale(d.pval)];\n            });\n            const hull = d3.polygonHull(hullPoints);\n            const color = colorScale(e[0]);\n\n            if (hull) {\n              svg.append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\n              .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none'); //disable hover effects\n            }\n\n            hullPoints = []; //refresh the array\n          });\n        } /////////////////////--convex hull 2--////////////////////////////////\n\n\n        function showHull2() {\n          var hullPoints = []; //create empty array where to store datapoints\n\n          const groups = d3.groups(newData, function (d) {\n            return d.category; //grouping done by categories, returns an array\n          }); //convex hull code by Nicola\n\n          groups.filter(function (G) {\n            const groupsize = G[1].filter(function (g) {\n              return g.pval < 0.0000001;\n            }).length;\n\n            if (groupsize > 0) {\n              return G;\n            }\n          }).forEach(e => {\n            const group = e[1];\n            group.forEach((d, i) => {\n              if (d.pval <= 0.0000001) {\n                hullPoints[i] = [xScale2(d.beta) + 40, yScale3(d.pval)];\n              }\n            });\n            const hull = d3.polygonHull(hullPoints);\n            const color = colorScale(e[0]);\n\n            if (hull) {\n              svg.data(hull).append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\n              .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none'); //disable hover effects\n            }\n\n            hullPoints = []; //refresh the hullpoints array in the end of the loop\n          });\n        } /////////////////////--convex hull 3 for zoom--///////////////////\n\n\n        function showHull3() {\n          //get min and max p values from selection for zooming\n          var pMax2 = d3.max(selection2, function (d) {\n            return d.pval;\n          });\n          var pMin2 = d3.min(selection2, function (d) {\n            return d.pval;\n          });\n          var yScale4 = d3.scaleLog().domain([pMin2 - pMin2 / 1.001, pMax2 + pMax2 * 2]).range([0, height]).nice(); //get min and max beta from selection for zooming\n\n          var betaMax3 = d3.max(selection2, function (d) {\n            return d.beta;\n          });\n          var betaMin3 = d3.min(selection2, function (d) {\n            return d.beta;\n          });\n          var xScale3 = d3.scaleLinear() //.domain([betaMin3-(betaMax3),betaMax3+(betaMin3*(-1))])\n          .domain([betaMin3 - 0.1, betaMax3 + 0.1]).range([0, width]);\n          var hullPoints = []; //create empty array where to store datapoints\n\n          const groups = d3.groups(selection2, function (d) {\n            return d.category; //grouping done by categories, returns an array\n          }); //convex hull code by Nicola\n\n          groups.filter(function (G) {\n            const groupsize = G[1].filter(function (g) {\n              return g.pval < 0.0000001;\n            }).length;\n\n            if (groupsize > 0) {\n              return G;\n            }\n          }).forEach(e => {\n            const group = e[1];\n            group.forEach((d, i) => {\n              hullPoints[i] = [xScale3(d.beta) + 40, yScale4(d.pval)];\n            });\n            const hull = d3.polygonHull(hullPoints);\n            const color = colorScale(e[0]);\n\n            if (hull) {\n              svg.data(hull).append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\n              .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none'); //disable hover effects\n            }\n\n            hullPoints = []; //refresh the hullpoints array in the end of the loop\n          });\n        } //hide the convex hull\n\n\n        function hideHull() {\n          svg.selectAll('.hullPath').remove(); //still need to remove the checkmark from the box on toggle\n        }\n\n        function removeText() {\n          //remove texts tagged with 'info' class\n          d3.selectAll('p.info').remove();\n        } ///////////////////--highlight pip--//////////////////////\n\n\n        var subset = data.filter(d => d.pip >= 0.1); //pip values bigger or equal to 0.1\n\n        var subset2 = data.filter(d => d.pip > 0 && d.pip < 0.1); //pip values bigger than zero but smaller than 0.1\n        //console.log(subset2)//subset 2 doesn't have anything for this dataset apparently\n\n        function showPip() {\n          svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n            return xScale(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale(d.pval);\n          }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.7).style('opacity', 1).style('pointer-events', 'none');\n        }\n\n        function showSmallPip() {\n          svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n            return xScale(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale(d.pval);\n          }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.5).style('opacity', 1).style('pointer-events', 'none');\n        } //for significant ones\n\n\n        function showPip2() {\n          svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n            return xScale2(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            if (d.pval <= 0.0000001) {\n              return yScale3(d.pval);\n            }\n          }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.7).style('opacity', 1).style('pointer-events', 'none');\n        }\n\n        function showSmallPip2() {\n          svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n            return xScale2(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            if (d.pval <= 0.0000001) {\n              return yScale3(d.pval);\n            }\n          }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.5).style('opacity', 1).style('pointer-events', 'none');\n        }\n\n        function hidePip() {\n          d3.selectAll('circle.pipdot').remove();\n        } ///////////////////////////////////////////////////////\n        ///////////////////--overview state--//////////////////\n        ////////////////////////////////////////////////////////\n\n\n        function overView() {\n          resetDiv();\n          clearSelections();\n          hideBtn();\n          hideZoomClear(); //interactiveLabels();\n          //create an svg for legend container since it's outside of the chart div\n\n          const svg3 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer'); //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\n\n          const legendBlockVar2 = svg3.append('g'); //another one for overView()\n          //enable the enter-zoom in overview state\n          //trigger a function with enter. https://stackoverflow.com/questions/40252637/keypress-trigger-a-function-if-specific-pressed\n\n          function checkKey(e) {\n            var key = e.which || e.keyCode;\n            if (key === 13) zooming();\n            showBtn();\n            hideBtns();\n            removeText(); //on enter zoom, remove old selection text and switch button view\n          }\n\n          document.addEventListener(\"keypress\", checkKey); //remove old stuff\n\n          svg.selectAll('.hullPath').remove();\n          svg.select('rect') //avoid multiple shading rects on top of each other\n          .remove();\n          d3.selectAll('g.tick') //remove ticks\n          .remove();\n          d3.selectAll('.circleCenter') //remove circles\n          .remove();\n          d3.selectAll('.newCircleCenter') //remove highlights\n          .remove();\n          d3.selectAll('.circleBackground').remove();\n          d3.selectAll('path.domain') //remove double scale lines\n          .remove();\n          d3.selectAll('line').remove();\n          d3.selectAll('.annotation-label').remove();\n          d3.selectAll('.annotation-rect').remove();\n          d3.selectAll('text.axisLabel').remove();\n          d3.select('g.brush').remove(); //remove old brush while changing the view\n\n          d3.selectAll('.legendContainer') //remove old legend\n          .remove();\n          d3.select('#gLegContainer').remove();\n          d3.selectAll('#gLegContainer3') //remove legend block from zoomm\n          .remove();\n          d3.selectAll('#gLegContainer4') //remove legend block from significance view\n          .remove();\n          labelLayer.selectAll(\"*\") //remove legend block from significance view\n          .remove(); //Append the X Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5).tickSize(-height)) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5); //Append the Y Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale).ticks(5).tickSize(-width)) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function (d) {\n            return d === 1 ? d : d.toExponential().replace('1e-', '');\n          }); //lightly color the zero side of the x-axis\n\n          chart.append('rect').attr(\"height\", height).attr('width', xScale(0)).attr(\"fill\", \"lightgray\").attr(\"opacity\", 0.2);\n          d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5);\n          chart.append('line').attr(\"x1\", 0).attr(\"y1\", yScale(0.0000001)).attr(\"x2\", width).attr(\"y2\", yScale(0.0000001)).style(\"stroke\", 'grey').style(\"stroke-dasharray\", \"3, 3\").style(\"stroke-width\", 0.5); //add labels\n\n          chart.append(\"text\").text(\"-log10 p-value\").attr(\"x\", 20).attr(\"y\", height / 1.8).attr(\"transform\", \"translate(-150,150) rotate(-90)\").attr('class', 'axisLabel').style('font-size', '0.4em').style('font-family', 'sans-serif');\n          chart.append(\"text\").attr(\"x\", width / 2).attr(\"y\", height * 1.08).attr('class', 'axisLabel').style(\"text-anchor\", \"middle\").text(\"beta value\").style('font-size', '0.4em').style('font-family', 'sans-serif'); //set up the tooltip\n\n          var tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-5, 0]).html((event, d) => {\n            return d.category + '<br>' + '<br>' + d.phenostring + '<br>' + '<br>' + \"p-value: \" + d.pval + \"<br>\" + \"beta value: \" + d.beta + '<br>' + \"cases / controls: \" + d.n_case + ' / ' + d.n_control + '<br>' + 'pip: ' + d.pip;\n          });\n          svg.call(tip); ///////////////////--bigger background dots--//////////////////////\n\n          var g = svg.append('g').attr(\"id\", \"dataPoints\") //make a new g element to which we append circles\n          .selectAll('g').data(data).enter().append('g');\n          g.append('circle').attr(\"cx\", function (d) {\n            return xScale(d.beta) + 40;\n          }) //added offset to align beta values\n          .attr(\"cy\", function (d) {\n            return yScale(d.pval);\n          }).attr('r', d => sqrtScale(d.n_case)).style('pointer-events', 'none') //disable hover effects\n          .style('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.1;\n            } else {\n              return 'opacity', 0.2;\n            }\n          }).attr('fill', d => colorScale(colorValue(d))); //color by category\n          ///////////////////////////--add dots--////////////////////////////\n\n          g.append('circle').attr(\"cx\", function (d) {\n            return xScale(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale(d.pval);\n          }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.4;\n            } else {\n              return 'opacity', 1;\n            }\n          }).attr('fill', d => colorScale(colorValue(d))) ////////////////////--hover events--////////////////////////////////\n          //tooltip\n          .on('mouseover.tip', tip.show, function () {\n            d3.select(this).transition().duration('100');\n          }).on('mouseout.tip', tip.hide) //highlight color\n          .on('mouseover.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n          }).on('mouseout.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }).attr('r', 2);\n          }) //add labels on click, mostly credit to Nicola\n          .on(\"click\", function (e, d) {\n            var x = parseFloat(d3.select(this).attr(\"cx\")),\n                y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n            let format = d3.format(',');\n            let formattedCases = format(d.n_case);\n            const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n            label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n            .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n          }) //reset labels on double-click\n          .on('dblclick', function () {\n            labelLayer.selectAll(\"*\").remove();\n          }); ////////////////////--legends--///////////////////////////////////////\n\n          newData = data.filter(d => d.pval <= 0.0000001); //categoryData = data.filter(d => d.category == 'Diseases marked as autimmune origin')\n          //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\n\n          const unique = [];\n          newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x)); //Initialize data\n\n          var chartData = unique; //Initialize legend\n\n          var clicked = \"\";\n          var legendItemSize = 8;\n          var legendSpacing = 20;\n          var xOffset = 10;\n          var yOffset = 10; //var labelsBlock = d3.select('#labels-block')\n\n          var gLeg = legendBlockVar2.selectAll('g').data(chartData).enter().append('g');\n          gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\n            var x = xOffset;\n            var y = yOffset + (legendItemSize + legendSpacing) * i;\n            return `translate(${x}, ${y})`;\n          });\n          gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category);\n          gLeg.on(\"mouseover.legend\", function (d) {\n            d3.selectAll('.newCircleCenter').remove();\n            var legendText = this.textContent; //get the text of the legend in a variable\n\n            var HighlightData = data.filter(d => d.category == legendText); //get the data objects associated with the legend\n\n            d3.selectAll('.circleCenter').style('opacity', 0.1); //on any click set all centers to hidemode\n            //.style('pointer-events', 'none')\n            //Append new circles\n\n            var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g');\n            g.append('circle').attr(\"cx\", function (d) {\n              return xScale(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              return yScale(d.pval);\n            }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d))) //tooltip\n            .on('mouseover.tip', tip.show, function () {\n              d3.select(this).transition().duration('100');\n            }).on('mouseout.tip', tip.hide) //highlight color\n            .on('mouseover.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n            }).on('mouseout.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2);\n            }) //add labels on click, mostly credit to Nicola\n            .on(\"click\", function (e, d) {\n              var x = parseFloat(d3.select(this).attr(\"cx\")),\n                  y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n              let format = d3.format(',');\n              let formattedCases = format(d.n_case);\n              const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n              label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n              label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n              label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n              .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n            }) //reset labels on double-click\n            .on('dblclick', function () {\n              labelLayer.selectAll(\"*\").remove();\n            }); //highlight selected gLeg group\n\n            d3.selectAll(gLeg).style('opacity', 0.5);\n            d3.select(this).style('opacity', 1);\n          }); //end of click\n          //double-click anywhere on the labels block\n\n          var labelsBlock = d3.select('#labels-block');\n          labelsBlock.on('mouseout.legend', function (d) {\n            //reset circlecenter opacity\n            d3.selectAll('.circleCenter').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }); //remove highlights\n\n            d3.selectAll('.newCircleCenter').remove(); //legend items back to full opacity\n\n            d3.selectAll(gLeg).style('opacity', 1);\n          }); //////////////////////--brushing--/////////////////////////\n          //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\n          //const selection2 = [];//an empty array where we can push data\n\n          const brush = d3.brush().extent([[0, 0], [width, height]]); //stay within the chart and above the significance\n          //attach the brush to the chart\n\n          const gBrush = chart.append('g').attr('class', 'brush').call(brush); //column setup for the brushed data\n\n          const table = d3.select('#info-column');\n          const categoryCol = d3.select('#category');\n          const phenoCol = d3.select('#phenotype');\n          const pvalCol = d3.select('#pval');\n          const betaCol = d3.select('#beta');\n          const caseCol = d3.select('#case-control'); //brush event inside the overview state\n\n          brush.on('end', function (event, d) {\n            const selection = event.selection; //the scope of the brush\n\n            d3.selectAll('circle').each(function (d) {\n              //go through the points\n              //condition: stay within the brush rect\n              if (selection && yScale(d.pval) > selection[0][1] && yScale(d.pval) < selection[1][1] && xScale(d.beta) > selection[0][0] && xScale(d.beta) < selection[1][0]) {\n                selection2.push(d); //push data to the empty array\n              }\n            }); //function to remove duplicate values from the array\n\n            function removeDuplicates(selection2) {\n              return selection2.filter((value, index) => selection2.indexOf(value) === index);\n            } //console.log(removeDuplicates(selection2))\n\n\n            categoryCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).attr('margin-top', function (d, i) {\n              if ('overflow-x' == true) {\n                return -3;\n              }\n            }).html(function (d) {\n              return d.category;\n            });\n            phenoCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.phenostring;\n            });\n            pvalCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.pval;\n            });\n            betaCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.beta;\n            });\n            caseCol.selectAll('p').data(removeDuplicates(selection2)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.n_case + ' / ' + d.n_control;\n            });\n          }); //hide the convex hull\n\n          function hideHull() {\n            svg.selectAll('.hullPath').remove(); //still need to remove the checkmark from the box on toggle\n          }\n\n          function removeText() {\n            //remove texts tagged with 'info' class\n            d3.selectAll('p.info').remove();\n          } ///////////////////--highlight pip--//////////////////////\n\n\n          var subset = data.filter(d => d.pip >= 0.1); //pip values bigger or equal to 0.1\n\n          var subset2 = data.filter(d => d.pip > 0 && d.pip < 0.1); //pip values bigger than zero but smaller than 0.1\n          //console.log(subset2)//subset 2 doesn't have anything for this dataset apparently\n\n          function showPip() {\n            svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n              return xScale(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              return yScale(d.pval);\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\n          }\n\n          function showSmallPip() {\n            svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n              return xScale(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              return yScale(d.pval);\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\n          } //for significant ones\n\n\n          function showPip2() {\n            svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n              return xScale2(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              if (d.pval <= 0.0000001) {\n                return yScale3(d.pval);\n              }\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\n          }\n\n          function showSmallPip2() {\n            svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function (d) {\n              return xScale2(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              if (d.pval <= 0.0000001) {\n                return yScale3(d.pval);\n              }\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\n          }\n\n          function hidePip() {\n            d3.selectAll('circle.pipdot').remove();\n          }\n\n          labelLayer.raise(); /////////////////////--csv download--///////////////////////////\n\n          function downloadCsv() {\n            //function to remove duplicate values from the array\n            function removeDuplicates(selection2) {\n              return selection2.filter((value, index) => selection2.indexOf(value) === index);\n            } //make the header\n\n\n            var data_export_csv_header = Object.keys(selection2[0]).join(),\n                //gets data keys as strings\n            rows = removeDuplicates(selection2); //this is the core\n\n            var data_export_csv_rows = rows.map(function (el) {\n              return Object.values(el).join();\n            }).join('\\n');\n            var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\n\n            /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\n\n            var blob = new Blob([data_export_csv]);\n\n            if (window.navigator.msSaveOrOpenBlob) {\n              window.navigator.msSaveBlob(blob, \"tableData.csv\");\n            } else {\n              var a = window.document.createElement(\"a\"); //empty element(link)\n\n              a.href = window.URL.createObjectURL(blob, {\n                type: \"text/plain\"\n              }); //console.log(a.href, 'ciao');\n\n              a.download = \"tableData.csv\";\n              document.body.appendChild(a);\n              a.click();\n              document.body.removeChild(a);\n            }\n          }\n\n          document.getElementById('button_styled_download').onclick = function () {\n            return downloadCsv();\n          };\n        } //end of overview\n        /////////////////////////////////////////////////////////////////////////\n        //////////////////--show significant ones function--////////////////////\n        /////////////////////////////////////////////////////////////////////////\n\n\n        function redrawScale() {\n          //despite the name redraw both the scales and the dots based on pval being smaller than 0.0000001\n          newData = data.filter(d => d.pval <= 0.0000001);\n          removeText();\n          resetDiv(); //interactiveLabels();\n          //remove old stuff\n\n          svg.selectAll('.hullPath').remove();\n          d3.selectAll('circle').remove();\n          d3.selectAll('g.tick').remove();\n          d3.selectAll('path.domain') //remove double scale lines\n          .remove();\n          d3.selectAll('line').remove();\n          d3.selectAll('.annotation-label').remove();\n          d3.selectAll('.annotation-rect').remove();\n          /*d3.selectAll('.legendContainer')\r\n            .remove();*/\n\n          d3.select('#gLegContainer').remove();\n          d3.select('rect').remove();\n          d3.select('#gLegContainer2').remove();\n          d3.select('g.brush').remove(); //remove old brush while changing the view\n          //clear label layer\n\n          labelLayer.selectAll(\"*\").remove(); //Append the new X Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale2).ticks(5).tickSize(-height)) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5); //Append the new Y Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale3).ticks(3).tickSize(-width)) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function (d) {\n            return d === 1 ? d : d.toExponential().replace('1e-', '');\n          }); //style the tick lines\n\n          d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5); //lightly color the zero side of the x-axis\n\n          chart.append('rect').attr(\"height\", height).attr('width', xScale2(0)).attr(\"fill\", \"lightgray\").attr(\"opacity\", 0.2); //Append new circles\n\n          var g = svg.append('g').selectAll('g').data(newData).enter().append('g');\n          g.append('circle').attr(\"cx\", function (d) {\n            return xScale2(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale3(d.pval);\n          }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d))) //tooltip\n          .on('mouseover.tip', tip.show, function () {\n            d3.select(this).transition().duration('100');\n          }).on('mouseout.tip', tip.hide) //highlight color\n          .on('mouseover.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n          }).on('mouseout.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }).attr('r', 2);\n          }) //add labels on click, mostly credit to Nicola\n          .on(\"click\", function (e, d) {\n            var x = parseFloat(d3.select(this).attr(\"cx\")),\n                y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n            let format = d3.format(',');\n            let formattedCases = format(d.n_case);\n            const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n            label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n            .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n          }) //reset labels on double-click\n          .on('dblclick', function () {\n            labelLayer.selectAll(\"*\").remove();\n          }); //bigger circles\n\n          g.append('circle').attr(\"id\", \"dataPoints\").attr(\"cx\", function (d) {\n            return xScale2(d.beta) + 40;\n          }) //added offset to align beta values\n          .attr(\"cy\", function (d) {\n            return yScale3(d.pval);\n          }).attr('r', d => sqrtScale(d.n_case)).style('pointer-events', 'none') //disable hover effects\n          .attr('class', 'circleBackground').style('opacity', 0.2).attr('fill', d => colorScale(colorValue(d))); //color by category\n          //brushing significant ones, help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\n\n          const brush = d3.brush().extent([[0, 0], [width, height]]); //stay within the chart and above the significance\n\n          const gBrush = chart.append('g').attr('class', 'brush').call(brush); //column setup for the brushed data\n\n          const table = d3.select('#info-column');\n          const categoryCol = d3.select('#category');\n          const phenoCol = d3.select('#phenotype');\n          const pvalCol = d3.select('#pval');\n          const betaCol = d3.select('#beta');\n          const caseCol = d3.select('#case-control'); //////////////////--legends--//////////////////////////////////////////\n          //significant ones label block\n          //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\n\n          const unique = [];\n          newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x)); //console.log(unique);\n          //Initialize data\n\n          var chartData = unique; //Initialize legend\n\n          var legendItemSize = 8;\n          var legendSpacing = 20;\n          var xOffset = 10;\n          var yOffset = 10; //create an svg for legend container since it's outside of the chart div\n\n          const svg5 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer'); //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\n\n          const legendBlockVar4 = svg5.append('g'); //another one for zooming()\n\n          var gLeg = legendBlockVar4.selectAll('g').data(chartData).enter().append('g');\n          gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\n            var x = xOffset;\n            var y = yOffset + (legendItemSize + legendSpacing) * i;\n            return `translate(${x}, ${y})`;\n          });\n          gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category);\n          gLeg.on(\"mouseover.legend\", function (d) {\n            d3.selectAll('.newCircleCenter').remove();\n            var legendText = this.textContent; //get the text of the legend in a variable\n\n            var HighlightData = newData.filter(d => d.category == legendText); //get the data objects associated with the legend\n\n            d3.selectAll('.circleCenter').style('opacity', 0.1); //on any click set all centers to hidemode\n            //.style('pointer-events', 'none')\n            //Append new circles\n\n            var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g');\n            g.append('circle').attr(\"cx\", function (d) {\n              return xScale2(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              return yScale3(d.pval);\n            }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d))) //tooltip\n            .on('mouseover.tip', tip.show, function () {\n              d3.select(this).transition().duration('100');\n            }).on('mouseout.tip', tip.hide) //highlight color\n            .on('mouseover.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n            }).on('mouseout.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2);\n            }) //add labels on click, mostly credit to Nicola\n            .on(\"click\", function (e, d) {\n              var x = parseFloat(d3.select(this).attr(\"cx\")),\n                  y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n              let format = d3.format(',');\n              let formattedCases = format(d.n_case);\n              const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n              label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n              label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n              label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n              .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n            }) //reset labels on double-click\n            .on('dblclick', function () {\n              labelLayer.selectAll(\"*\").remove();\n            }); //highlight selected gLeg group\n\n            d3.selectAll(gLeg).style('opacity', 0.5);\n            d3.select(this).style('opacity', 1);\n          }); //end of click\n          //double-click anywhere on the labels block\n\n          var labelsBlock = d3.select('#labels-block');\n          labelsBlock.on('mouseout.legend', function (d) {\n            //reset circlecenter opacity\n            d3.selectAll('.circleCenter').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }); //remove highlights\n\n            d3.selectAll('.newCircleCenter').remove(); //legend items back to full opacity\n\n            d3.selectAll(gLeg).style('opacity', 1);\n          }); ////////////////////////////////////////////////////////////////////\n          //brush event\n\n          brush.on('end', function (event, d) {\n            const selection = event.selection; //the scope of the brush\n\n            d3.selectAll('circle').each(function (d) {\n              //go through the points\n              //condition: stay within the brush rect\n              if (selection && yScale3(d.pval) > selection[0][1] && yScale3(d.pval) < selection[1][1] && xScale2(d.beta) > selection[0][0] && xScale2(d.beta) < selection[1][0]) {\n                selection3.push(d); //push data to the empty array\n              }\n            }); //function to remove duplicate values from the array\n\n            function removeDuplicates2(selection2) {\n              return selection3.filter((value, index) => selection3.indexOf(value) === index);\n            }\n\n            categoryCol.selectAll('p').data(removeDuplicates2(selection3)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).attr('margin-top', function (d, i) {\n              if ('overflow-x' == true) {\n                return -3;\n              }\n            }).html(function (d) {\n              return d.category;\n            });\n            phenoCol.selectAll('p').data(removeDuplicates2(selection3)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.phenostring;\n            });\n            pvalCol.selectAll('p').data(removeDuplicates2(selection3)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.pval;\n            });\n            betaCol.selectAll('p').data(removeDuplicates2(selection3)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.beta;\n            });\n            caseCol.selectAll('p').data(removeDuplicates2(selection3)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.n_case + ' / ' + d.n_control;\n            });\n          });\n\n          function removeText() {\n            //remove texts tagged with 'info' class\n            d3.selectAll('p.info').remove();\n          }\n\n          labelLayer.raise(); /////////////////////--csv download--///////////////////////////\n\n          function downloadCsv() {\n            //function to remove duplicate values from the array\n            function removeDuplicates(selection3) {\n              return selection3.filter((value, index) => selection3.indexOf(value) === index);\n            } //make the header\n\n\n            var data_export_csv_header = Object.keys(selection3[0]).join(),\n                //gets data keys as strings\n            rows = removeDuplicates(selection3); //this is the core\n\n            var data_export_csv_rows = rows.map(function (el) {\n              return Object.values(el).join();\n            }).join('\\n');\n            var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\n\n            /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\n\n            var blob = new Blob([data_export_csv]);\n\n            if (window.navigator.msSaveOrOpenBlob) {\n              window.navigator.msSaveBlob(blob, \"tableData.csv\");\n            } else {\n              var a = window.document.createElement(\"a\"); //empty element(link)\n\n              a.href = window.URL.createObjectURL(blob, {\n                type: \"text/plain\"\n              }); //console.log(a.href, 'ciao');\n\n              a.download = \"tableData.csv\";\n              document.body.appendChild(a);\n              a.click();\n              document.body.removeChild(a);\n            }\n          }\n\n          document.getElementById('button_styled_download').onclick = function () {\n            return downloadCsv();\n          };\n        } //end of redraw\n        /////////////////////////////////////////////////////\n        //////////////////--simple zoom----//////////////////\n        ////////////////////////////////////////////////////\n\n\n        function zooming() {\n          showZoomClear();\n          resetDiv(); //reset the legend block\n          //remove old stuff\n\n          svg.selectAll('.hullPath') //remove hull if there is one\n          .remove();\n          svg.selectAll('rect').remove();\n          d3.selectAll('circle') //remove old circles\n          .remove();\n          d3.selectAll('g.tick') //remove old ticks from old scales\n          .remove();\n          d3.selectAll('path.domain') //remove double scale lines\n          .remove();\n          d3.select('g.brush') //remove old brush square\n          .remove(); //remove annotations\n\n          d3.selectAll('.annotation-label').remove();\n          d3.selectAll('.annotation-rect').remove();\n          d3.selectAll('.legendContainer') //remove old legends\n          .remove();\n          d3.selectAll('#gLegContainer').remove();\n          d3.selectAll('#gLegContainer2').remove();\n          d3.selectAll('#gLegContainer3').remove();\n          d3.selectAll('line').remove(); //clear label layer\n\n          labelLayer.selectAll(\"*\").remove(); //create an svg for legend container since it's outside of the chart div\n\n          const svg4 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer'); //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\n\n          const legendBlockVar3 = svg4.append('g'); //another one for zooming()\n          //get min and max p values from selection for zooming\n\n          var pMax2 = d3.max(selection2, function (d) {\n            return d.pval;\n          });\n          var pMin2 = d3.min(selection2, function (d) {\n            return d.pval;\n          });\n          var yScale4 = d3.scaleLog().domain([pMin2 - pMin2 / 1.001, pMax2 + pMax2 * 2]).range([0, height]).nice(); //get min and max beta from selection for zooming\n\n          var betaMax3 = d3.max(selection2, function (d) {\n            return d.beta;\n          });\n          var betaMin3 = d3.min(selection2, function (d) {\n            return d.beta;\n          });\n          var xScale3 = d3.scaleLinear() //.domain([betaMin3-(betaMax3),betaMax3+(betaMin3*(-1))])\n          .domain([betaMin3 - 0.1, betaMax3 + 0.1]).range([0, width]); //Append the new X Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale3).ticks(5, '.2f').tickSize(-height)) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5); //Append the new Y Axis\n\n          chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale4).tickSize(-width).tickArguments([5, \".0f\"])) //adjust tick labels\n          .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function (d) {\n            return d === 1 ? d : d.toExponential().replace('1e-', '');\n          }); //style the tick lines\n\n          d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5); //lightly color the zero side of the x-axis\n\n          chart.append('rect').attr(\"height\", height).attr('width', xScale3(0)).attr(\"fill\", \"lightgray\").attr(\"opacity\", 0.2);\n          var g = svg.append('g') //make a new g element to which we append circles\n          .selectAll('g').data(selection2).enter().append('g');\n          g.append('circle').attr(\"cx\", function (d) {\n            return xScale3(d.beta) + 40;\n          }).attr(\"cy\", function (d) {\n            return yScale4(d.pval);\n          }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.4;\n            } else {\n              return 'opacity', 1;\n            }\n          }).attr('fill', d => colorScale(colorValue(d))) //tooltip\n          .on('mouseover.tip', tip.show, function () {\n            d3.select(this).transition().duration('100');\n          }).on('mouseout.tip', tip.hide) //highlight color\n          .on('mouseover.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n          }).on('mouseout.color', function () {\n            d3.select(this).transition().duration('200').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }).attr('r', 2);\n          }) //add labels on click, mostly credit to Nicola\n          .on(\"click\", function (e, d) {\n            var x = parseFloat(d3.select(this).attr(\"cx\")),\n                y = parseFloat(d3.select(this).attr(\"cy\")); //format the case number with a comma separator\n\n            let format = d3.format(',');\n            let formattedCases = format(d.n_case);\n            const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x + 10}px,${y + 10}px)`);\n            label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\");\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted)); //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \n\n            label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted)) //tspan in a separate line\n            .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted));\n          }) //reset labels on double-click\n          .on('dblclick', function () {\n            labelLayer.selectAll(\"*\").remove();\n          }); //bigger background dots\n\n          g.append('circle').attr(\"id\", \"dataPoints\").attr(\"cx\", function (d) {\n            return xScale3(d.beta) + 40;\n          }) //added offset to align beta values\n          .attr(\"cy\", function (d) {\n            return yScale4(d.pval);\n          }).attr('r', d => sqrtScale(d.n_case)).style('pointer-events', 'none') //disable hover effects\n          .attr('class', 'circleBackground').style('opacity', function (d) {\n            if (d.pval >= 0.0000001) {\n              return 'opacity', 0.1;\n            } else {\n              return 'opacity', 0.2;\n            }\n          }).attr('fill', d => colorScale(colorValue(d))); //color by category\n\n          g.append('line').attr(\"x1\", 40).attr(\"y1\", function (d) {\n            if (d.pval > 0.0000001) {\n              return yScale4(0.0000001);\n            }\n          }).attr(\"x2\", width + 40).attr(\"y2\", function (d) {\n            if (d.pval > 0.0000001) {\n              return yScale4(0.0000001);\n            }\n          }).style(\"stroke\", 'grey').style(\"stroke-dasharray\", \"3, 3\").style(\"stroke-width\", 0.3); //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\n\n          const brush = d3.brush().extent([[0, 0], [width, height]]); //stay within the chart\n          //attach the brush to the chart\n\n          const gBrush = chart.append('g').attr('class', 'brush').call(brush); ////////////////////////////////////////////////////////////\n          //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\n\n          const unique = [];\n          selection2.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x)); //Initialize data\n\n          var chartData = unique; //Initialize legend\n\n          var legendItemSize = 8;\n          var legendSpacing = 20;\n          var xOffset = 10;\n          var yOffset = 10;\n          var gLeg = legendBlockVar3.selectAll('g').data(chartData).enter().append('g');\n          gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\n            var x = xOffset;\n            var y = yOffset + (legendItemSize + legendSpacing) * i;\n            return `translate(${x}, ${y})`;\n          });\n          gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category); ////////////////////////////////////////////////////////////////////\n          //attaching click to the legend text for now\n\n          gLeg.on(\"mouseover.legend\", function (d) {\n            d3.selectAll('.newCircleCenter').remove();\n            var legendText = this.textContent; //get the text of the legend in a variable\n\n            var HighlightData = selection2.filter(d => d.category == legendText); //get the data objects associated with the legend\n\n            d3.selectAll('.circleCenter').style('opacity', 0.1); //on any click set all centers to hidemode\n            //.style('pointer-events', 'none')\n            //Append new circles\n\n            var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g');\n            g.append('circle').attr(\"cx\", function (d) {\n              return xScale3(d.beta) + 40;\n            }).attr(\"cy\", function (d) {\n              return yScale4(d.pval);\n            }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d))) //tooltip\n            .on('mouseover.tip', tip.show, function () {\n              d3.select(this).transition().duration('100');\n            }).on('mouseout.tip', tip.hide) //highlight color\n            .on('mouseover.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case));\n            }).on('mouseout.color', function () {\n              d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2);\n            }); //highlight selected gLeg group\n\n            d3.selectAll(gLeg).style('opacity', 0.5);\n            d3.select(this).style('opacity', 1);\n          }); //end of click\n          //double-click anywhere on the labels block\n\n          var labelsBlock = d3.select('#labels-block');\n          labelsBlock.on('mouseout.legend', function (d) {\n            //reset circlecenter opacity\n            d3.selectAll('.circleCenter').style('opacity', function (d) {\n              if (d.pval >= 0.0000001) {\n                return 'opacity', 0.4;\n              } else {\n                return 'opacity', 1;\n              }\n            }); //remove highlights\n\n            d3.selectAll('.newCircleCenter').remove(); //legend items back to full opacity\n\n            d3.selectAll(gLeg).style('opacity', 1);\n          }); //column setup for the brushed data\n\n          const categoryCol = d3.select('#category');\n          const phenoCol = d3.select('#phenotype');\n          const pvalCol = d3.select('#pval');\n          const betaCol = d3.select('#beta');\n          const caseCol = d3.select('#case-control'); //brush event\n\n          brush.on('end', function (event, d) {\n            const selection = event.selection; //the scope of the brush\n\n            d3.selectAll('circle').each(function (d) {\n              //go through the points\n              if (selection && yScale4(d.pval) > selection[0][1] && yScale4(d.pval) < selection[1][1] && xScale3(d.beta) > selection[0][0] && xScale3(d.beta) < selection[1][0]) {\n                selection4.push(d); //push data to the empty array\n              }\n            }); //function to remove duplicate values from the array\n\n            function removeDuplicates3(selection4) {\n              return selection4.filter((value, index) => selection4.indexOf(value) === index);\n            } //console.log(removeDuplicates3(selection4));\n\n            /*new values to table from selection 4*/\n\n\n            categoryCol.selectAll('p').data(removeDuplicates3(selection4)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).attr('margin-top', function (d, i) {\n              if ('overflow-x' == true) {\n                return -3;\n              }\n            }).html(function (d) {\n              return d.category;\n            });\n            phenoCol.selectAll('p').data(removeDuplicates3(selection4)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.phenostring;\n            });\n            pvalCol.selectAll('p').data(removeDuplicates3(selection4)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.pval;\n            });\n            betaCol.selectAll('p').data(removeDuplicates3(selection4)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.beta;\n            });\n            caseCol.selectAll('p').data(removeDuplicates3(selection4)).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function (d, i) {\n              return i * 12;\n            }).html(function (d) {\n              return d.n_case + ' / ' + d.n_control;\n            });\n          });\n          labelLayer.raise();\n\n          function downloadCsvZoom() {\n            //function to remove duplicate values from the array\n            function removeDuplicates3(selection4) {\n              return selection4.filter((value, index) => selection4.indexOf(value) === index);\n            } //make the header\n\n\n            var data_export_csv_header = Object.keys(selection4[0]).join(),\n                //gets data keys as strings\n            rows = removeDuplicates3(selection4); //this is the core\n\n            var data_export_csv_rows = rows.map(function (el) {\n              return Object.values(el).join();\n            }).join('\\n');\n            var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\n\n            /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\n\n            var blob = new Blob([data_export_csv]);\n\n            if (window.navigator.msSaveOrOpenBlob) {\n              window.navigator.msSaveBlob(blob, \"tableData.csv\");\n            } else {\n              var a = window.document.createElement(\"a\"); //empty element(link)\n\n              a.href = window.URL.createObjectURL(blob, {\n                type: \"text/plain\"\n              }); //console.log(a.href, 'ciao');\n\n              a.download = \"tableData.csv\";\n              document.body.appendChild(a);\n              a.click();\n              document.body.removeChild(a);\n            }\n          }\n\n          document.getElementById('button_styled_download_zoom').onclick = function () {\n            return downloadCsvZoom();\n          };\n\n          console.log(selection4);\n        } //end of zoom\n        //hide the convex hull\n\n\n        function hideHull() {\n          svg.selectAll('.hullPath').remove();\n        }\n\n        function removeBrush2() {\n          //remove brush selection\n          selection3.length = 0;\n        }\n\n        function removeBrush3() {\n          //remove brush selection\n          selection4.length = 0;\n        }\n\n        const labelLayer = svg.append('g').attr(\"id\", \"labelLayer\");\n\n        function dragLabelStarted(event) {\n          const label = d3.select(this.parentNode);\n          event.on(\"drag\", dragged).on(\"end\", ended);\n\n          function dragged(event) {\n            label.select(\"line\").raise().attr(\"x1\", event.x).attr(\"y1\", event.y - 2.5);\n            label.select(\"text\").raise().attr(\"x\", event.x).attr(\"y\", event.y).style(\"cursor\", \"grabbing\");\n          }\n\n          function ended() {\n            label.select(\"text\").style(\"cursor\", \"grab\");\n          }\n        } //end of label drag\n        //const [ciao,setCiao] = useState ('ciao!') \n\n      } //end bracket for lavaa function\n\n\n      volcano(props);\n    }\n  });\n\n  function downloadImgClick() {\n    myToggle();\n    downloadImg();\n  } //hide download option buttons\n\n\n  function hideDownloadOptions() {\n    var show = document.getElementById('download-options');\n    show.style.display = 'none';\n  } //toggle download button\n\n\n  function myToggle() {\n    var x = document.getElementById(\"download-options\");\n\n    if (x.style.display === \"none\") {\n      x.style.display = \"block\";\n    } else {\n      x.style.display = \"none\";\n    }\n  } /////////////////////--image download by Nicola--////////////////\n\n\n  function downloadImg() {\n    //show options\n    //d3.select(\"#download-options\").style(\"display\",\"block\")\n\n    /* PREPARE SVG DOWNLOAD BUTTON */\n    //get svg element.\n    var svg = d3.select(\"#chart\").select(\"svg\").node();\n    var headline = d3.select(\"#headline-block\").select(\"text\").node(); //console.log(headline)\n    //get svg source.\n\n    var serializer = new XMLSerializer();\n    var source = serializer.serializeToString(svg); //add name spaces.\n\n    if (!source.match(/^<svg[^>]+xmlns=\"http\\:\\/\\/www\\.w3\\.org\\/2000\\/svg\"/)) {\n      source = source.replace(/^<svg/, '<svg xmlns=\"http://www.w3.org/2000/svg\"');\n    }\n\n    if (!source.match(/^<svg[^>]+\"http\\:\\/\\/www\\.w3\\.org\\/1999\\/xlink\"/)) {\n      source = source.replace(/^<svg/, '<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\"');\n    } //add xml declaration\n\n\n    source = '<?xml version=\"1.0\" standalone=\"no\"?>\\r\\n' + source; //convert svg source to URI data scheme.\n\n    var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(source); //set url value to a element's href attribute.\n\n    document.getElementById(\"downloadSvg\").href = url; //you can download svg file by right click menu.\n\n    let svgWithBg = d3.select(\"#chart\").select(\"svg\").style(\"background-color\", \"white\").node();\n    var svgString = new XMLSerializer().serializeToString(svgWithBg); // var DOMURL = window.location.pathname; // invalid request\n\n    var img = new Image();\n    var svgAbs = new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    });\n    var url = URL.createObjectURL(svgAbs);\n\n    img.onload = function () {\n      let canvas = document.createElement('canvas');\n      canvas.height = 750;\n      canvas.width = 799.5;\n      var ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(img, 0, 0, 799.5, 800); // var jpg = canvas.toDataURL(\"image/jpeg\",1.0);\n      // DOMURL.revokeObjectURL(jpg);\n\n      var image = canvas.toDataURL(\"image/jpeg\", 1.0);\n      document.getElementById(\"downloadJpeg\").href = image;\n    };\n\n    img.src = url;\n  }\n\n  const selection2 = []; //an empty array where we can push brushed data\n\n  const selection3 = []; //an empty array where we can push brushed data\n\n  const selection4 = []; //an empty array where we can push brushed data\n\n  function removeText() {\n    //remove texts tagged with 'info' class\n    d3.selectAll('p.info').remove();\n  }\n\n  function removeBrush() {\n    //remove brush selection\n    selection.length = 0;\n  }\n\n  function removeBrush2() {\n    //remove brush selection\n    selection3.length = 0;\n  }\n\n  function removeBrush3() {\n    //remove brush selection\n    selection4.length = 0;\n  }\n  /*this doesn't work because selection is empty here, but if I call a function in the onClick that is inside the main function and has values in the array, the function itself returns not defined*/\n\n\n  function tableClick() {\n    removeText();\n    removeBrush();\n    removeBrush2();\n    removeBrush3();\n  }\n  /*const [selection, setDataSelection] = useState([])\r\n  function readData(){\r\n    //format d3 data reader for tab separated files, then use setDataRaw\r\n    d3.dsv(\"\\t\", data).then(selection=>{\r\n      //defining new selection\r\n      selection = newSelection\r\n      setDataSelection(newSelection);\r\n    })\r\n    console.log(newSelection);\r\n  }*/\n\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"btn-block\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"btn-block-toggle\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"button_styled\",\n            onClick: () => tableClick(),\n            children: \"Clear selection\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2202,\n            columnNumber: 10\n          }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button_styled\",\n              id: \"button_styled_download\",\n              children: \"Download table\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2203,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2203,\n            columnNumber: 10\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2201,\n          columnNumber: 3\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"btn-block-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"button_styled-2\",\n            onClick: () => tableClick(),\n            children: \"Clear selection\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2206,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button_styled\",\n              id: \"button_styled_download_zoom\",\n              children: \"Download table\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2207,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2207,\n            columnNumber: 10\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2205,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"info-column-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"info-column\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"category\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"h5\",\n                style: {\n                  width: '10vw'\n                },\n                children: \"Category\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2213,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2212,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"phenotype\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"h5\",\n                style: {\n                  width: '10vw'\n                },\n                children: \"Phenotype\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2216,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2215,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"pval\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"h5\",\n                style: {\n                  maxWidth: '10vw'\n                },\n                children: \"P-value\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2219,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2218,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"beta\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"h5\",\n                style: {\n                  maxWidth: '10vw'\n                },\n                children: \"Beta\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2222,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2221,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"case-control\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"h5\",\n                style: {\n                  maxWidth: '10vw'\n                },\n                children: \"Cases/Controls\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2225,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2224,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2211,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"labels-block\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"divider-vertical\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2231,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"labels-block-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                id: \"button_legend\",\n                children: \"Show legend \\u2192\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2233,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"button_collapse\",\n                id: \"buttonCollapse\",\n                children: \"\\u2190 Collapse\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2234,\n                columnNumber: 12\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2232,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2230,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2210,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2200,\n        columnNumber: 2\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2197,\n      columnNumber: 1\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"chart\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"headline-block\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"chart-btn-block\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chart-btn-container\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flexbox-checkbox\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"hideThese\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  id: \"input-btn-block\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2250,\n                  columnNumber: 10\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2249,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                id: \"button_back\",\n                children: \"Go back\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2255,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"ZoomHull\",\n                children: /*#__PURE__*/_jsxDEV(\"label\", {\n                  className: \"h5\",\n                  children: [\"Convex hulls\", /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    id: \"hullCheckboxZoom\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2259,\n                    columnNumber: 24\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"checkmark-custom\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2260,\n                    columnNumber: 24\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2258,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2257,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"hullCheckboxDiv\",\n                style: {\n                  marginTop: '1%'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"label\", {\n                  className: \"h5\",\n                  style: {\n                    paddingLeft: '1vw'\n                  },\n                  children: [\"Convex hulls\", /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    id: \"hullCheckbox\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2266,\n                    columnNumber: 24\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"checkmark-custom\",\n                    id: \"hullCheckMark\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2267,\n                    columnNumber: 24\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2265,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2264,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"significanceCheckboxDiv\",\n                style: {\n                  marginTop: '1%'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"label\", {\n                  className: \"h5\",\n                  style: {\n                    paddingLeft: '4vw'\n                  },\n                  children: [\"Show significant\", /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    id: \"significanceCheckbox\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2273,\n                    columnNumber: 24\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"checkmark-custom-2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2274,\n                    columnNumber: 24\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2272,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2271,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"pipCheckboxDiv\",\n                style: {\n                  marginTop: '1%'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"label\", {\n                  className: \"h5\",\n                  style: {\n                    paddingLeft: '4vw'\n                  },\n                  children: [\"Show PIP > 0\", /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    id: \"pipCheckbox\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2280,\n                    columnNumber: 24\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"checkmark-custom-3\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2281,\n                    columnNumber: 24\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2279,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2278,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2247,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2246,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2245,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"downloadImg-block\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"download\",\n            onClick: () => {\n              downloadImgClick();\n            },\n            children: \"download image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2290,\n            columnNumber: 5\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"reportIssue\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"reportIcon\",\n              children: \"?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2292,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n              id: \"report\",\n              href: \"mailto:stella.keppo@aalto.fi?subject=Issue report from LAVAA\",\n              className: \"h5\",\n              style: {\n                paddingLeft: '0.5vw'\n              },\n              children: \"Report issue\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2293,\n              columnNumber: 11\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2291,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2289,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"chartInner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2297,\n          columnNumber: 4\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2244,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2243,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"download-options\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"download-options-inner\",\n        children: [/*#__PURE__*/_jsxDEV(\"a\", {\n          id: \"downloadSvg\",\n          download: \"LAVAA_volcano.svg\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"downloadImgBtn\",\n            onClick: () => hideDownloadOptions(),\n            children: \"svg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2305,\n            columnNumber: 10\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2304,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          id: \"downloadJpeg\",\n          download: \"LAVAA_volcano\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"downloadImgBtn\",\n            onClick: () => hideDownloadOptions(),\n            children: \"jpeg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2308,\n            columnNumber: 10\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2307,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"close\",\n          id: \"closeBtn\",\n          onClick: () => hideDownloadOptions(),\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"ico-times\",\n            role: \"img\",\n            \"aria-label\": \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2311,\n            columnNumber: 10\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2310,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2303,\n        columnNumber: 6\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2302,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"upload-options-background\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"upload-options\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2317,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2316,\n      columnNumber: 1\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Lavaa, \"xY/bnHEdjlPZqj+wvdsBwjTI/ZI=\");\n\n_c = Lavaa;\nexport default Lavaa;\n\nvar _c;\n\n$RefreshReg$(_c, \"Lavaa\");","map":{"version":3,"sources":["C:/Users/keppo/Desktop/react_folder/lavaa/src/lavaa.js"],"names":["React","useState","useEffect","d3module","tip","d3tip","d3","Lavaa","props","selection","setSelection","ready","setReady","data","dataprop","showBtn","back","document","getElementById","style","display","showZoomHull","hideBtn","hideBack","hideZoomHull","hideBtns","hide","hideHull","hideSig","hidePip","showBtnBlock","show","showHull","showSig","showPip","showImgDownload","showZoomClear","hideZoomClear","myToggle","x","showLegends","showL","opacity","resetDiv","collapsed","marginRight","width","hideCollapseBtn","legendTexts","querySelectorAll","forEach","element","visibility","downloadCsvZoom","removeDuplicates3","selection4","filter","value","index","indexOf","data_export_csv_header","Object","keys","join","rows","data_export_csv_rows","map","el","values","data_export_csv","blob","Blob","window","navigator","msSaveOrOpenBlob","msSaveBlob","a","createElement","href","URL","createObjectURL","type","download","body","appendChild","click","removeChild","volcano","selection2","selection3","removeText","selectAll","remove","removeBrush2","length","removeBrush3","hideDownloadOptions","select","onclick","expandDiv","checked","showHull2","showHull3","redrawScale","overView","showPip2","expanded","showCollapseBtn","collapseDiv","goBack","removeBrush","clearSelections","heightValue","widthValue","svg","append","attr","margin","top","bottom","left","right","chart","height","svg2","legendBlockVar","f","format","yScale","scaleLog","yScale2","yScale3","colorScale","scaleOrdinal","range","schemeTableau10","colorValue","d","category","colorScale2","max","pval","min","maxCases","n_case","domain","nice","betaMax","beta","betaMin","betaMax2","betaMin2","biggerBeta","xScale","scaleLinear","xScale2","sqrtScale","scaleSqrt","checkKey","e","key","which","keyCode","zooming","addEventListener","call","axisBottom","ticks","tickSize","axisLeft","text","toExponential","replace","offset","html","event","phenostring","n_control","pip","g","enter","on","transition","duration","parseFloat","y","formattedCases","label","labelLayer","classed","drag","dragLabelStarted","newData","unique","push","chartData","clicked","legendItemSize","legendSpacing","xOffset","yOffset","gLeg","i","legendText","textContent","HighlightData","labelsBlock","brush","extent","gBrush","table","categoryCol","phenoCol","pvalCol","betaCol","caseCol","each","removeDuplicates","downloadCsv","hullPoints","groups","G","groupsize","group","hull","polygonHull","color","pMax2","pMin2","yScale4","betaMax3","betaMin3","xScale3","subset","subset2","showSmallPip","showSmallPip2","svg3","legendBlockVar2","raise","svg5","legendBlockVar4","removeDuplicates2","svg4","legendBlockVar3","tickArguments","console","log","parentNode","dragged","ended","downloadImgClick","downloadImg","node","headline","serializer","XMLSerializer","source","serializeToString","match","url","encodeURIComponent","svgWithBg","svgString","img","Image","svgAbs","onload","canvas","ctx","getContext","drawImage","image","toDataURL","src","tableClick","position","maxWidth","marginTop","paddingLeft"],"mappings":"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","sourcesContent":["import './style.css';\r\nimport React, { useState, useEffect } from 'react';\r\nimport * as d3module from 'd3';\r\nimport { tip as d3tip } from \"d3-v6-tip\";\r\n\r\n\r\nconst d3 = {\r\n  ...d3module,\r\n  tip: d3tip\r\n}\r\n\r\nfunction Lavaa(props) {\r\n\r\nlet [selection,setSelection] = useState([]) \r\nlet [ready, setReady] = useState(false) //set the initial state to be not ready\r\n//console.log(props.dataprop);\r\n\r\nconst data = props.dataprop;\r\n\r\nuseEffect(() => {\r\n\r\nif(!ready){ //if not ready, then:\r\nsetReady(true)\r\n\r\n/////////////////////--file upload by Nicola, disabled for this component--///////////////////////////\r\n\r\n        /*const fileUpload = document.getElementById(\"data-file\")\r\n        fileUpload.onchange = () => {\r\n            const reader = new FileReader();\r\n            const dataFile = fileUpload.files[0]\r\n            var fileInput = document.getElementById('data-file');\r\n            var filename = fileInput.files[0].name;\r\n            reader.readAsText(dataFile, \"UTF-8\")\r\n            reader.onload = () => {\r\n              const data = reader.result.split(\"\\r\\n\").slice(1).map(e => {\r\n                const values = e.split(\"\\t\");\r\n                //console.log(parseFloat(values[3]));\r\n                return {\r\n                  \"phenocode\": values[0],\r\n                  \"phenostring\": values[1],\r\n                  \"category\": values[2],\r\n                  \"pval\": parseFloat(values[3].replace(\",\",\".\")),\r\n                  \"beta\": parseFloat(values[4].replace(\",\",\".\")),\r\n                  \"maf\": parseFloat(values[5]),\r\n                  \"maf_case\": parseFloat(values[6]),\r\n                  \"maf_control\": parseFloat(values[7]),\r\n                  \"n_case\": parseFloat(values[8]),\r\n                  \"n_control\": parseFloat(values[9]),\r\n                  \"pip\": parseFloat(values[10]?.replace(\",\",\".\")|| 0),\r\n                }\r\n              }).filter(e => e.pval < 1);\r\n              d3.select(\"#chart\").select(\"svg\").remove();\r\n              volcano(data)\r\n                //interactiveLabels();\r\n            }\r\n          } //end of onchange*/\r\n\r\n/////////////////////--file upload for start screen, no longer used--///////////////////////////\r\n\r\n/*const fileUploadStart = document.getElementById(\"data-file-start\")\r\nfileUploadStart.onchange = () => {\r\n    const reader = new FileReader();\r\n    const dataFile = fileUploadStart.files[0]\r\n    var fileInput = document.getElementById('data-file-start');\r\n    var filename = fileInput.files[0].name;\r\n    reader.readAsText(dataFile, \"UTF-8\")\r\n    reader.onload = () => {\r\n      const data = reader.result.split(\"\\r\\n\").slice(1).map(e => {\r\n        const values = e.split(\"\\t\");\r\n        return {\r\n          \"phenocode\": values[0],\r\n          \"phenostring\": values[1],\r\n          \"category\": values[2],\r\n          \"pval\": parseFloat(values[3].replace(\",\",\".\")),\r\n          \"beta\": parseFloat(values[4].replace(\",\",\".\")),\r\n          \"maf\": parseFloat(values[5]),\r\n          \"maf_case\": parseFloat(values[6]),\r\n          \"maf_control\": parseFloat(values[7]),\r\n          \"n_case\": parseFloat(values[8]),\r\n          \"n_control\": parseFloat(values[9]),\r\n          \"pip\": parseFloat(values[10]?.replace(\",\",\".\")|| 0),\r\n        }\r\n      }).filter(e => e.pval < 1);\r\n      d3.select(\"#chart\").select(\"svg\").remove();\r\n      volcano(data)\r\n        //interactiveLabels();\r\n    }\r\n  } //end of onchange*/\r\n\r\n\r\n        //show zoom state buttons\r\n        function showBtn() {\r\n          var back = document.getElementById(\"button_back\");\r\n          back.style.display = \"block\";\r\n          var showZoomHull = document.getElementById(\"ZoomHull\");\r\n          showZoomHull.style.display = \"block\";\r\n        }\r\n        //hide zoom state buttons\r\n        function hideBtn() {\r\n          var hideBack = document.getElementById(\"button_back\");\r\n          hideBack.style.display = \"none\";\r\n          var hideZoomHull = document.getElementById(\"ZoomHull\");\r\n          hideZoomHull.style.display = \"none\";\r\n        }\r\n        //hide normal view buttons on zoom\r\n        function hideBtns() {\r\n          var hide = document.getElementById(\"hideThese\");\r\n          hide.style.display = \"none\";\r\n          var hideHull = document.getElementById(\"hullCheckboxDiv\");\r\n          hideHull.style.display = \"none\";\r\n          var hideSig = document.getElementById(\"significanceCheckboxDiv\");\r\n          hideSig.style.display = \"none\";\r\n          var hidePip = document.getElementById(\"pipCheckboxDiv\");\r\n          hidePip.style.display = \"none\";\r\n        }\r\n        //show normal view buttons on zoom\r\n        function showBtnBlock() {\r\n          var show = document.getElementById(\"hideThese\");\r\n          show.style.display = \"block\";\r\n          var showHull = document.getElementById(\"hullCheckboxDiv\");\r\n          showHull.style.display = \"block\";\r\n          var showSig = document.getElementById(\"significanceCheckboxDiv\");\r\n          showSig.style.display = \"block\";\r\n          var showPip = document.getElementById(\"pipCheckboxDiv\");\r\n          showPip.style.display = \"block\";\r\n        }\r\n        //hide download image button, use before image is shown\r\n        function showImgDownload() {\r\n          var show = document.getElementById('downloadImg-block');\r\n          show.style.display = 'block';\r\n        }\r\n\r\n        //show zoom clear selection button\r\n        function showZoomClear() {\r\n          var hide = document.getElementById('btn-block-toggle');\r\n          hide.style.display = 'none';\r\n          var show = document.getElementById('btn-block-2');\r\n          show.style.display = 'block';\r\n        }\r\n        //hide zoom clear selection button\r\n        function hideZoomClear() {\r\n          var show = document.getElementById('btn-block-toggle');\r\n          show.style.display = 'block';\r\n          var hide = document.getElementById('btn-block-2');\r\n          hide.style.display = 'none';\r\n        }\r\n        //toggle download button\r\n        function myToggle() {\r\n          var x = document.getElementById(\"download-options\");\r\n          if(x.style.display === \"none\") {\r\n            x.style.display = \"block\";\r\n          } else {\r\n            x.style.display = \"none\";\r\n          }\r\n        }\r\n        //show legends\r\n        function showLegends() {\r\n          var showL = document.getElementById('labels-block');\r\n          showL.style.opacity = '1';\r\n        }\r\n\r\n        function resetDiv(){\r\n              var collapsed = document.getElementById('labels-block')\r\n              collapsed.style.marginRight = '0vw';\r\n              collapsed.style.width = '5vw';\r\n              var showBtn = document.getElementById('button_legend');\r\n              showBtn.style.display = 'block';\r\n              var hideCollapseBtn = document.getElementById('buttonCollapse');\r\n              hideCollapseBtn.style.display = 'none';\r\n              // Get a NodeList of all elements\r\n              const legendTexts = document.querySelectorAll('.label');\r\n              // Change the visibility attr of multiple elements with a loop\r\n              legendTexts.forEach(element => {\r\n                element.style.visibility = 'hidden';\r\n              });\r\n          }\r\n\r\n          /*function hideStartView(){\r\n            var startView = document.getElementById('start');\r\n            var showChart = document.getElementById('afterStart');\r\n            startView.style.display = \"none\";\r\n            showChart.style.display = \"block\";\r\n          }*/\r\n\r\n        function downloadCsvZoom() {\r\n          //function to remove duplicate values from the array\r\n          function removeDuplicates3(selection4) {\r\n            return selection4.filter((value, index) => selection4.indexOf(value) === index);\r\n          }\r\n          //make the header\r\n          var data_export_csv_header = Object.keys(selection4[0]).join(), //gets data keys as strings\r\n            rows = removeDuplicates3(selection4);\r\n          //this is the core\r\n          var data_export_csv_rows = rows.map(function(el) {\r\n              return Object.values(el).join()\r\n            }).join('\\n');\r\n          var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\r\n          /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\r\n          var blob = new Blob([data_export_csv]);\r\n          if(window.navigator.msSaveOrOpenBlob) {\r\n            window.navigator.msSaveBlob(blob, \"tableData.csv\");\r\n          } else {\r\n            var a = window.document.createElement(\"a\"); //empty element(link)\r\n            a.href = window.URL.createObjectURL(blob, {\r\n              type: \"text/plain\"\r\n            });\r\n            //console.log(a.href, 'ciao');\r\n            a.download = \"tableData.csv\";\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            document.body.removeChild(a);\r\n          }\r\n        }\r\n\r\n\r\n/////////////////////////////////////////////////////\r\n//////----the main function starts here---///////////\r\n/////////////////////////////////////////////////////\r\n\r\n        function volcano() {\r\n\r\n        \r\n        const selection2 = []; //an empty array where we can push brushed data\r\n        const selection3 = []; //an empty array where we can push brushed data\r\n        const selection4 = []; //an empty array where we can push brushed data\r\n        function removeText() { //remove texts tagged with 'info' class\r\n          d3.selectAll('p.info').remove();\r\n        }\r\n        function removeBrush2() { //remove brush selection\r\n          selection3.length = 0;\r\n        }\r\n        function removeBrush3() { //remove brush selection\r\n          selection4.length = 0;\r\n        }\r\n\r\n         //hideStartView();\r\n          showImgDownload();\r\n          hideDownloadOptions();\r\n          showLegends();\r\n          d3.select('.h2').remove();\r\n          d3.select('#gLegContainer').remove();\r\n          d3.select('#gLegContainer2').remove();\r\n          document.getElementById('button_legend').onclick = function() {\r\n            return expandDiv();\r\n          };\r\n          document.getElementById('hullCheckbox').onclick = function() {\r\n            if(this.checked) {\r\n              if(document.getElementById('significanceCheckbox').checked) {\r\n                return showHull2();\r\n              } else {\r\n                return showHull();\r\n              }\r\n            } else {\r\n              return hideHull();\r\n            }\r\n          };\r\n          document.getElementById('hullCheckboxZoom').onclick = function() {\r\n            if(this.checked) {\r\n              return showHull3();\r\n            } else {\r\n              return hideHull();\r\n            }\r\n          };\r\n          //show and hide convex hull with a checkbox\r\n          document.getElementById('significanceCheckbox').onclick = function() {\r\n            if(this.checked) {\r\n              return redrawScale(); // show significant ones\r\n            } else {\r\n              return overView(); //return to normal state\r\n            }\r\n          };\r\n          //show and hide pip with a checkbox\r\n          document.getElementById('pipCheckbox').onclick = function() {\r\n            if(this.checked) {\r\n              if(document.getElementById('significanceCheckbox').checked) {\r\n                return showPip2();\r\n              } else {\r\n                return showPip();\r\n              } // show nodes with high pip-values\r\n            } else {\r\n              return hidePip(); //hide pip indication\r\n            }\r\n          };\r\n\r\n          function expandDiv() {\r\n            var expanded = document.getElementById('labels-block')\r\n            expanded.style.marginRight = '-50vw';\r\n            expanded.style.width = '50vw';\r\n            var hideBtn = document.getElementById('button_legend');\r\n            hideBtn.style.display = 'none';\r\n            var showCollapseBtn = document.getElementById('buttonCollapse');\r\n            showCollapseBtn.style.display = 'block';\r\n            document.getElementById('buttonCollapse').onclick = function() {\r\n                return collapseDiv();\r\n              }\r\n              // Get a NodeList of all elements\r\n            const legendTexts = document.querySelectorAll('.label');\r\n            // Change the visibility attr of multiple elements with a loop\r\n            legendTexts.forEach(element => {\r\n              element.style.visibility = 'visible';\r\n            });\r\n\r\n            function collapseDiv() {\r\n              var collapsed = document.getElementById('labels-block')\r\n              collapsed.style.marginRight = '0vw';\r\n              collapsed.style.width = '5vw';\r\n              var showBtn = document.getElementById('button_legend');\r\n              showBtn.style.display = 'block';\r\n              var hideCollapseBtn = document.getElementById('buttonCollapse');\r\n              hideCollapseBtn.style.display = 'none';\r\n              // Get a NodeList of all elements\r\n              const legendTexts = document.querySelectorAll('.label');\r\n              // Change the visibility attr of multiple elements with a loop\r\n              legendTexts.forEach(element => {\r\n                element.style.visibility = 'hidden';\r\n              });\r\n            }\r\n          } //end of expand-collapse\r\n\r\n\r\n          function goBack() {\r\n            overView();\r\n            showBtnBlock();\r\n          }\r\n\r\n          function removeBrush() { //remove brush selection\r\n            selection2.length = 0;\r\n           }\r\n          function removeBrush2() { //remove brush selection\r\n            selection3.length = 0;\r\n          }\r\n          function removeBrush3() { //remove brush selection\r\n            selection4.length = 0;\r\n          }\r\n\r\n          function clearSelections() {\r\n            removeText();\r\n            removeBrush();\r\n            removeBrush2();\r\n            removeBrush3();\r\n          }\r\n          document.getElementById('button_styled').onclick = function() {\r\n            return clearSelections();\r\n          };\r\n          document.getElementById('button_styled-2').onclick = function() {\r\n            return clearSelections();\r\n          };\r\n          document.getElementById('button_back').onclick = function() {\r\n              return goBack();\r\n            }\r\n\r\n          //setting values for the viewBox\r\n          const heightValue = 330;\r\n          const widthValue = 320;\r\n        \r\n          //Create SVG and padding for the chart\r\n          /*var svg = d3.select(\"#chartInner\").select(\"svg\").nodes.length === 0 ? \r\n            d3.select(\"#chartInner\")\r\n              .append(\"svg\")\r\n              .attr(\"viewBox\", `2 -10 320 330`)\r\n              .attr(\"stroke-width\", \"0.3\")\r\n             : d3.select(\"#chartInner\")\r\n             .select(\"svg\");*/\r\n\r\n             /*if(d3.select(\"#chartInner\").select(\"svg\").nodes().length === 0){\r\n              var svg = d3.select(\"#chartInner\")\r\n              .append(\"svg\")\r\n              .attr(\"viewBox\", `2 -10 320 330`)\r\n              .attr(\"stroke-width\", \"0.3\");\r\n             } else {\r\n              var svg = d3.select(\"#chartInner\")\r\n              .select(\"svg\");\r\n             }*/\r\n\r\n          const svg = d3.select(\"#chartInner\").append(\"svg\")\r\n          .attr(\"viewBox\", `2 -10 320 330`)\r\n          .attr(\"stroke-width\", \"0.3\");\r\n          const margin = {\r\n            top: 50,\r\n            bottom: 50,\r\n            left: 40,\r\n            right: 2\r\n          };\r\n          const chart = svg.append(\"g\").attr(\"transform\", `translate(${margin.left},0)`);\r\n          const width = 320 - margin.left - margin.right; //width of the chart\r\n          const height = 330 - margin.top - margin.bottom; //height of the chart\r\n\r\n          //create an svg for legend container since it's outside of the chart div\r\n          const svg2 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer')\r\n          //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\r\n          const legendBlockVar = svg2.append('g').attr(\"transform\", `translate(${margin.right},0)`);\r\n\r\n          const f = d3.format(\".1f\");\r\n\r\n          //Initiating Y- and color-scales\r\n          var yScale = d3.scaleLog()\r\n          var yScale2 = d3.scaleLog()\r\n          var yScale3 = d3.scaleLog()\r\n          const colorScale = d3.scaleOrdinal().range(d3.schemeTableau10);\r\n          const colorValue = d => d.category; //Color value by category\r\n          const colorScale2 = d3.scaleOrdinal().range(d3.schemeTableau10);\r\n          //getting max and min y (p-value) values\r\n          var max = d3.max(data, function(d) {\r\n            return d.pval;\r\n          });\r\n          var min = d3.min(data, function(d) {\r\n              return d.pval;\r\n            })\r\n          //max for the case numbers\r\n          var maxCases = d3.max(data, function(d){\r\n            return d.n_case;\r\n          });\r\n            //create two Yscales with different ranges\r\n          yScale.domain([min, max])\r\n            .range([0, height]).nice();\r\n          yScale2.domain([0.0000001, max + 5]) //padding to the bottom\r\n            .range([200, 250]);\r\n          //extra y-scale for showing only significant values\r\n          yScale3.domain([min, 0.0000001]).range([0, height]).nice();\r\n          //getting max and min x (beta) values\r\n          var betaMax = d3.max(data, function(d) {\r\n            return d.beta;\r\n          });\r\n          var betaMin = d3.min(data, function(d) {\r\n            return d.beta;\r\n          });\r\n          //get min and max beta from significant ones\r\n          var betaMax2 = d3.max(data, function(d) {\r\n            if(d.pval <= 0.0000001) {\r\n              return d.beta;\r\n            }\r\n          });\r\n          var betaMin2 = d3.min(data, function(d) {\r\n            if(d.pval <= 0.0000001) {\r\n              return d.beta;\r\n            }\r\n          });\r\n          var biggerBeta = d3.max(data, function(d){\r\n            if(betaMax > betaMin*(-1)){\r\n              return betaMax;\r\n            } else {return betaMin*(-1)}\r\n          })\r\n          //create x-scale\r\n          var xScale = d3.scaleLinear().domain([biggerBeta*(-1)-0.1, biggerBeta+0.1]) //make x-scale symmetrical\r\n            .range([0, width]);\r\n          var xScale2 = d3.scaleLinear().domain([betaMin2-0.1, betaMax2+0.1]).range([0, width]);\r\n          //initializing square root scale for scaling datapoint size\r\n          var sqrtScale = d3.scaleSqrt().domain([0, maxCases]).range([2,10]); //only allow a slight change in values since variation is huge\r\n          //var fileInput = document.getElementById('data-file');\r\n          //var filename = fileInput.files[0].name;\r\n          //var headline = d3.select('#headline-block')\r\n          //var newStr = filename.replace(/_/g, \":\");\r\n          /*headline.append('text').attr(\"x\", 0).attr(\"y\", 0).attr('class', 'h2').text(function(d) {\r\n            return newStr.split('.')[0] //get the filename without the extension\r\n              .slice(0, -23)\r\n          });*/\r\n          //enable the enter-zoom in first state\r\n          //trigger a function with enter. https://stackoverflow.com/questions/40252637/keypress-trigger-a-function-if-specific-pressed\r\n          function checkKey(e) {\r\n            var key = e.which || e.keyCode;\r\n            if(key === 13) zooming();\r\n            showBtn();\r\n            hideBtns();\r\n            removeText(); //on enter zoom, remove old selection text and switch button view\r\n          }\r\n          document.addEventListener(\"keypress\", checkKey);\r\n          //Append the X Axis\r\n          chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5).tickSize(-height))\r\n            //adjust tick labels\r\n            .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5);\r\n          //Append the Y Axis\r\n          chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale)\r\n            .ticks(5)\r\n              .tickSize(-width))\r\n            //adjust tick labels\r\n            .selectAll('text').attr('class', 'yTickLabel').style('font-size', '0.5em').style('opacity', 0.5)\r\n            .text(function(d) {\r\n              return d === 1 ? d : d.toExponential().replace('1e-', '');\r\n            });\r\n          //add labels\r\n          chart.append(\"text\")\r\n          .text(\"-log10 p-value\")\r\n          .attr(\"x\", 20)\r\n          .attr(\"y\", height / 1.8)\r\n          .attr(\"transform\", \"translate(-150,150) rotate(-90)\")\r\n          .attr('class', 'axisLabel')\r\n          .style('font-size', '0.4em')\r\n          .style('font-family', 'sans-serif')\r\n          chart.append(\"text\")\r\n          .attr(\"x\", width / 2)\r\n          .attr(\"y\", height * 1.08)\r\n          .attr('class', 'axisLabel')\r\n          .style(\"text-anchor\", \"middle\")\r\n          .text(\"beta value\")\r\n          .style('font-size', '0.4em')\r\n          .style('font-family', 'sans-serif')\r\n          //lightly color the zero side of the x-axis\r\n          chart.append('rect')\r\n          .attr(\"height\", height)\r\n          .attr('width', xScale(0))\r\n          .attr(\"fill\", \"lightgray\")\r\n          .attr(\"opacity\", 0.2);\r\n          d3.selectAll('g.tick')\r\n          .select('line')\r\n          .style('stroke-width', 0.1)\r\n          .style('opacity', 0.5);\r\n          chart.append('line')\r\n          .attr(\"x1\", 0)\r\n          .attr(\"y1\", yScale(0.0000001))\r\n          .attr(\"x2\", width)\r\n          .attr(\"y2\", yScale(0.0000001))\r\n          .style(\"stroke\", 'grey')\r\n          .style(\"stroke-dasharray\", (\"3, 3\"))\r\n          .style(\"stroke-width\", 0.5);\r\n          //set up the tooltip\r\n          var tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-5, 0]).html((event, d) => {\r\n            return d.category + '<br>' + '<br>' + d.phenostring + '<br>' + '<br>' + \"p-value: \" + d.pval + \"<br>\" + \"beta value: \" + d.beta + '<br>' + \"cases / controls: \" + d.n_case + ' / ' + d.n_control + '<br>' + 'pip: ' + d.pip\r\n          });\r\n          svg.call(tip);\r\n\r\n\r\n///////////////////--bigger background dots--//////////////////////\r\n\r\n          var g = svg.append('g') //make a new g element to which we append circles\r\n           .attr(\"id\", \"dataPoints\").selectAll('g').data(data).enter().append('g')\r\n          g.append('circle').attr(\"cx\", function(d) {\r\n              return xScale(d.beta) + 40;\r\n            }) //+margin-left amount\r\n            .attr(\"cy\", function(d) {\r\n              return yScale(d.pval)\r\n            })\r\n            .attr('r', d => sqrtScale(d.n_case))\r\n            .style('pointer-events', 'none') //disable hover effects\r\n            .style('opacity', function(d) {\r\n              if(d.pval >= 0.0000001) {\r\n                return 'opacity', 0.1\r\n              } else {\r\n                return 'opacity', 0.2\r\n              }\r\n            }).attr('fill', d => colorScale(colorValue(d))) //color by category\r\n\r\n\r\n///////////////////////////--add dots--////////////////////////////\r\n\r\n         g.append('circle').attr(\"cx\", function(d) {\r\n              return xScale(d.beta) + 40;\r\n            }) //+margin-left amount\r\n            .attr(\"cy\", function(d) {\r\n              return yScale(d.pval)\r\n            }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter')\r\n            .attr('r', 2).attr('stroke', 'white').attr('opacity', function(d) {\r\n              if(d.pval >= 0.0000001) {\r\n                return 'opacity', 0.4\r\n              } else {\r\n                return 'opacity', 1\r\n              }\r\n            }).attr('fill', d => colorScale(colorValue(d)))\r\n\r\n\r\n////////////////////--hover events--////////////////////////////////\r\n\r\n            //tooltip\r\n            .on('mouseover.tip', tip.show, function() {\r\n              d3.select(this).transition().duration('100');\r\n            }).on('mouseout.tip', tip.hide)\r\n            //highlight color\r\n            .on('mouseover.color', function() {\r\n              d3.select(this).transition().duration('200').style('opacity', 1)\r\n              .attr('r', d => sqrtScale(d.n_case))\r\n            }).on('mouseout.color', function() {\r\n              d3.select(this).transition().duration('200').style('opacity', function(d) {\r\n                if(d.pval >= 0.0000001) {\r\n                  return 'opacity', 0.4\r\n                } else {\r\n                  return 'opacity', 1\r\n                }\r\n              }).attr('r', 2)\r\n            })\r\n            //add labels on click, mostly credit to Nicola\r\n            .on(\"click\", function(e, d) {\r\n              var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                y = parseFloat(d3.select(this).attr(\"cy\"));\r\n              //format the case number with a comma separator\r\n              let format = d3.format(',');\r\n              let formattedCases = format(d.n_case);\r\n              const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n              label.append(\"line\")\r\n              .attr(\"x1\", 0)\r\n              .attr(\"y1\", -2.5)\r\n              .attr(\"x2\", -10)\r\n              .attr(\"y2\", -10)\r\n              .style(\"stroke-width\", \"0.5px\")\r\n              .style(\"stroke\", \"#d3d3d3\")\r\n              label.append(\"text\")\r\n              .style(\"font-size\", \"5px\")\r\n              .style(\"font-family\", \"sans-serif\")\r\n              .style(\"cursor\", \"grab\")\r\n              .text(d.phenostring)\r\n              .call(d3.drag()\r\n\r\n              .on(\"start\", dragLabelStarted))\r\n              //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n              label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                //tspan in a separate line\r\n                .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n            })\r\n            //reset labels on double-click\r\n            .on('dblclick', function() {\r\n              labelLayer.selectAll(\"*\").remove();\r\n            });\r\n\r\n\r\n//////////////////////--labels--//////////////////////////////////////\r\n\t\t \r\n          var newData = data.filter(d => d.pval <= 0.0000001);\r\n            //categoryData = data.filter(d => d.category == 'Diseases marked as autimmune origin')\r\n            //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\r\n          const unique = [];\r\n          newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x));\r\n          //Initialize data\r\n          var chartData = unique;\r\n          //Initialize legend\r\n          var clicked = \"\"\r\n          var legendItemSize = 8;\r\n          var legendSpacing = 20;\r\n          var xOffset = 10;\r\n          var yOffset = 10;\r\n          //var labelsBlock = d3.select('#labels-block')\r\n          var gLeg = legendBlockVar.selectAll('g').data(chartData).enter().append('g')\r\n          gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\r\n            var x = xOffset;\r\n            var y = yOffset + (legendItemSize + legendSpacing) * i;\r\n            return `translate(${x}, ${y})`;\r\n          })\r\n          gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category)\r\n            ////////////////////////////////////////////////////////////////////\r\n            //attaching click to the legend text for now\r\n          gLeg.on(\"mouseover.legend\", function(d) {\r\n              d3.selectAll('.newCircleCenter').remove();\r\n              var legendText = this.textContent; //get the text of the legend in a variable\r\n              var HighlightData = data.filter(d => d.category == legendText) //get the data objects associated with the legend\r\n              d3.selectAll('.circleCenter').style('opacity', 0.1) //on any click set all centers to hidemode\r\n                //.style('pointer-events', 'none')\r\n                //Append new circles\r\n              var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g')\r\n              g.append('circle').attr(\"cx\", function(d) {\r\n                  return xScale(d.beta) + 40;\r\n                }).attr(\"cy\", function(d) {\r\n                  return yScale(d.pval)\r\n                }).attr('fill', d => colorScale(colorValue(d)))\r\n                .attr('class', 'newCircleCenter')\r\n                .attr('r', 2)\r\n                .attr('stroke', 'white')\r\n                .attr('opacity', 1)\r\n                .attr('fill', d => colorScale(colorValue(d)))\r\n                //tooltip\r\n                .on('mouseover.tip', tip.show, function() {\r\n                  d3.select(this).transition().duration('100');\r\n                }).on('mouseout.tip', tip.hide)\r\n                //highlight color\r\n                .on('mouseover.color', function() {\r\n                  d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n                }).on('mouseout.color', function() {\r\n                  d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2)\r\n                })\r\n                //add labels on click, mostly credit to Nicola\r\n                .on(\"click\", function(e, d) {\r\n                  var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                    y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                  //format the case number with a comma separator\r\n                  let format = d3.format(',');\r\n                  let formattedCases = format(d.n_case);\r\n                  const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                  label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\")\r\n                  label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                    //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                  label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                    //tspan in a separate line\r\n                    .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                })\r\n                //reset labels on double-click\r\n                .on('dblclick', function() {\r\n                  labelLayer.selectAll(\"*\").remove();\r\n                });\r\n              //highlight selected gLeg group\r\n              d3.selectAll(gLeg).style('opacity', 0.5)\r\n              d3.select(this).style('opacity', 1);\r\n            }) //end of click\r\n            //double-click anywhere on the labels block\r\n          var labelsBlock = d3.select('#labels-block')\r\n          labelsBlock.on('mouseout.legend', function(d) {\r\n              //reset circlecenter opacity\r\n              d3.selectAll('.circleCenter').style('opacity', function(d) {\r\n                  if(d.pval >= 0.0000001) {\r\n                    return 'opacity', 0.4\r\n                  } else {\r\n                    return 'opacity', 1\r\n                  }\r\n                })\r\n                //remove highlights\r\n              d3.selectAll('.newCircleCenter').remove();\r\n              //legend items back to full opacity\r\n              d3.selectAll(gLeg).style('opacity', 1);\r\n            })\r\n\r\n\r\n//////////////////////--brushing--/////////////////////////\r\n\r\n            //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\r\n            //const selection2 = [];//an empty array where we can push data\r\n          const brush = d3.brush().extent([\r\n            [0, 0],\r\n            [width, height]\r\n          ]); //stay within the chart and above the significance\r\n          //attach the brush to the chart\r\n          const gBrush = chart.append('g').attr('class', 'brush').call(brush);\r\n          //column setup for the brushed data\r\n          const table = d3.select('#info-column');\r\n          const categoryCol = d3.select('#category');\r\n          const phenoCol = d3.select('#phenotype');\r\n          const pvalCol = d3.select('#pval');\r\n          const betaCol = d3.select('#beta');\r\n          const caseCol = d3.select('#case-control');\r\n          //brush event inside the first state\r\n          brush.on('end', function(event, d) {\r\n            const selection = event.selection; //the scope of the brush\r\n            d3.selectAll('circle').each(function(d) { //go through the points\r\n                if(selection && yScale(d.pval) > selection[0][1] && yScale(d.pval) < selection[1][1] && xScale(d.beta) > selection[0][0] && xScale(d.beta) < selection[1][0]) {\r\n                  selection2.push(d) //push data to the empty array\r\n                }\r\n              })\r\n              //function to remove duplicate values from the array\r\n            function removeDuplicates(selection2) {\r\n              return selection2.filter((value, index) => selection2.indexOf(value) === index);\r\n            }\r\n            //console.log(removeDuplicates(selection2))\r\n            categoryCol.selectAll('p')\r\n            .data((removeDuplicates(selection2)))\r\n              .enter()\r\n              .append('div')\r\n              .attr('class', 'myScroll')\r\n              .style('overflow-x', 'auto')\r\n              .append('p')\r\n              .attr('class', 'info')\r\n              .html(function(d) {\r\n                return d.category;\r\n              })\r\n\r\n            phenoCol.selectAll('p')\r\n            .data((removeDuplicates(selection2)))\r\n            .enter()\r\n            .append('div')\r\n            .attr('class', 'myScroll')\r\n            .style('overflow-x', 'auto')\r\n            .attr('id', 'row')\r\n            .append('p')\r\n            .attr('class', 'info')\r\n            .attr('x', 10)\r\n            .attr('y', function(d, i) {\r\n              return i * 12;\r\n            }).html(function(d) {\r\n              return d.phenostring;\r\n            })\r\n            pvalCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n              return i * 12;\r\n            }).html(function(d) {\r\n              return d.pval;\r\n            })\r\n            betaCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n              return i * 12;\r\n            }).html(function(d) {\r\n              return d.beta;\r\n            })\r\n            caseCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('class', 'myScroll').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n              return i * 12;\r\n            }).html(function(d) {\r\n              return d.n_case + ' / ' + d.n_control;\r\n            }) \r\n            setSelection(selection2)\r\n          });\r\n\r\n  /////////////////////--csv download--///////////////////////////\r\n function downloadCsv() {\r\n  //function to remove duplicate values from the array\r\n  function removeDuplicates(selection2) {\r\n    return selection2.filter((value, index) => selection2.indexOf(value) === index);\r\n  }\r\n  //make the header\r\n  var data_export_csv_header = Object.keys(selection2[0]).join(), //gets data keys as strings\r\n    rows = removeDuplicates(selection2);\r\n  //this is the core\r\n  var data_export_csv_rows = rows.map(function(el) {\r\n      return Object.values(el).join()\r\n    }).join('\\n');\r\n  var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\r\n  /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\r\n  var blob = new Blob([data_export_csv]);\r\n  if(window.navigator.msSaveOrOpenBlob) {\r\n    window.navigator.msSaveBlob(blob, \"tableData.csv\");\r\n  } else {\r\n    var a = window.document.createElement(\"a\"); //empty element(link)\r\n    a.href = window.URL.createObjectURL(blob, {\r\n      type: \"text/plain\"\r\n    });\r\n    //console.log(a.href, 'ciao');\r\n    a.download = \"tableData.csv\";\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  }\r\n}\r\n\r\ndocument.getElementById('button_styled_download').onclick = function() {\r\n  return downloadCsv();\r\n};\r\n\r\n/////////////////////--convex hull--////////////////////////////////\r\n\r\n          function showHull() { // wrapped the hull in a function\r\n            //convex hull code by Nicola\r\n            var hullPoints = []; //create empty array where to store datapoints\r\n            const groups = d3.groups(data, function(d) {\r\n              return d.category; //grouping done by categories, returns an array\r\n            }).filter(function(G) {\r\n              const groupsize = G[1].filter(function(g) {\r\n                return g.pval < 0.0000001;\r\n              }).length;\r\n              if(groupsize > 0) {\r\n                return G;\r\n              }\r\n            })\r\n            groups.forEach(e => {\r\n              const group = e[1]\r\n              group.forEach((d, i) => {\r\n                hullPoints[i] = [xScale(d.beta) + 40, yScale(d.pval)]\r\n              })\r\n              const hull = d3.polygonHull(hullPoints)\r\n              const color = colorScale(e[0])\r\n              if(hull) {\r\n                svg.append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\r\n                  .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none') //disable hover effects\r\n              }\r\n              hullPoints = [] //refresh the array\r\n            })\r\n          }\r\n\r\n\r\n/////////////////////--convex hull 2--////////////////////////////////\r\n\r\n          function showHull2() {\r\n            var hullPoints = []; //create empty array where to store datapoints\r\n            const groups = d3.groups(newData, function(d) {\r\n                return d.category; //grouping done by categories, returns an array\r\n              })\r\n              //convex hull code by Nicola\r\n            groups.filter(function(G) {\r\n              const groupsize = G[1].filter(function(g) {\r\n                return g.pval < 0.0000001;\r\n              }).length;\r\n              if(groupsize > 0) {\r\n                return G;\r\n              }\r\n            }).forEach(e => {\r\n              const group = e[1]\r\n              group.forEach((d, i) => {\r\n                if(d.pval <= 0.0000001) {\r\n                  hullPoints[i] = [xScale2(d.beta) + 40, yScale3(d.pval)]\r\n                }\r\n              })\r\n              const hull = d3.polygonHull(hullPoints)\r\n              const color = colorScale(e[0])\r\n              if(hull) {\r\n                svg.data(hull).append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\r\n                  .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none') //disable hover effects\r\n              }\r\n              hullPoints = [] //refresh the hullpoints array in the end of the loop\r\n            })\r\n          }\r\n\r\n\r\n/////////////////////--convex hull 3 for zoom--///////////////////\r\n\r\n          function showHull3() {\r\n            //get min and max p values from selection for zooming\r\n            var pMax2 = d3.max(selection2, function(d) {\r\n              return d.pval;\r\n            });\r\n            var pMin2 = d3.min(selection2, function(d) {\r\n              return d.pval;\r\n            })\r\n            var yScale4 = d3.scaleLog().domain([pMin2 - (pMin2 / 1.001), pMax2 + (pMax2 * 2)]).range([0, height]).nice();\r\n            //get min and max beta from selection for zooming\r\n            var betaMax3 = d3.max(selection2, function(d) {\r\n              return d.beta;\r\n            });\r\n            var betaMin3 = d3.min(selection2, function(d) {\r\n              return d.beta;\r\n            });\r\n            var xScale3 = d3.scaleLinear()\r\n              //.domain([betaMin3-(betaMax3),betaMax3+(betaMin3*(-1))])\r\n              .domain([betaMin3-0.1, betaMax3+0.1]).range([0, width]);\r\n            var hullPoints = []; //create empty array where to store datapoints\r\n            const groups = d3.groups(selection2, function(d) {\r\n                return d.category; //grouping done by categories, returns an array\r\n              })\r\n              //convex hull code by Nicola\r\n            groups.filter(function(G) {\r\n              const groupsize = G[1].filter(function(g) {\r\n                return g.pval < 0.0000001;\r\n              }).length;\r\n              if(groupsize > 0) {\r\n                return G;\r\n              }\r\n            }).forEach(e => {\r\n              const group = e[1]\r\n              group.forEach((d, i) => {\r\n                hullPoints[i] = [xScale3(d.beta) + 40, yScale4(d.pval)]\r\n              })\r\n              const hull = d3.polygonHull(hullPoints)\r\n              const color = colorScale(e[0])\r\n              if(hull) {\r\n                svg.data(hull).append(\"path\").attr('class', 'hullPath').attr(\"d\", \"M\" + hull.join(\"L\") + \"Z\") //generates the line; M-moveto a specific point, L-lineto a specificpoint, Z-closepath. hull joined by a lineto\r\n                  .attr(\"stroke\", color).attr(\"stroke-width\", 0.25).attr(\"fill\", color).attr(\"fill-opacity\", 0.1).style('pointer-events', 'none') //disable hover effects\r\n              }\r\n              hullPoints = [] //refresh the hullpoints array in the end of the loop\r\n            })\r\n          }\r\n          //hide the convex hull\r\n          function hideHull() {\r\n            svg.selectAll('.hullPath').remove();\r\n            //still need to remove the checkmark from the box on toggle\r\n          }\r\n\r\n          function removeText() { //remove texts tagged with 'info' class\r\n            d3.selectAll('p.info').remove();\r\n          }\r\n          \r\n\r\n///////////////////--highlight pip--//////////////////////\r\n\r\n          var subset = data.filter(d => d.pip >= 0.1); //pip values bigger or equal to 0.1\r\n          var subset2 = data.filter(d => d.pip > 0 && d.pip < 0.1); //pip values bigger than zero but smaller than 0.1\r\n          //console.log(subset2)//subset 2 doesn't have anything for this dataset apparently\r\n          function showPip() {\r\n            svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n              return xScale(d.beta)+40;\r\n            }).attr(\"cy\", function(d) {\r\n              return yScale(d.pval)\r\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.7).style('opacity', 1).style('pointer-events', 'none');\r\n          }\r\n\r\n          function showSmallPip() {\r\n            svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n              return xScale(d.beta)+40;\r\n            }).attr(\"cy\", function(d) {\r\n              return yScale(d.pval)\r\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.5).style('opacity', 1).style('pointer-events', 'none');\r\n          }\r\n          //for significant ones\r\n          function showPip2() {\r\n            svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n              return xScale2(d.beta)+40;\r\n            }).attr(\"cy\", function(d) {\r\n              if(d.pval <= 0.0000001) {\r\n                return yScale3(d.pval)\r\n              }\r\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.7).style('opacity', 1).style('pointer-events', 'none');\r\n          }\r\n\r\n          function showSmallPip2() {\r\n            svg.selectAll(\".dot\")\r\n            .data(subset2)\r\n            .enter()\r\n            .append(\"circle\")\r\n            .attr('r', 2)\r\n            .attr('class', 'pipdot')\r\n            .attr(\"cx\", function(d) {\r\n              return xScale2(d.beta)+40;\r\n            }).attr(\"cy\", function(d) {\r\n              if(d.pval <= 0.0000001) {\r\n                return yScale3(d.pval)\r\n              }\r\n            }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('stroke-width', 0.5).style('opacity', 1).style('pointer-events', 'none');\r\n          }\r\n\r\n          function hidePip() {\r\n            d3.selectAll('circle.pipdot').remove();\r\n          }\r\n\r\n\r\n///////////////////////////////////////////////////////\r\n///////////////////--overview state--//////////////////\r\n////////////////////////////////////////////////////////\r\n\r\n          function overView() {\r\n            resetDiv();\r\n            clearSelections();\r\n            hideBtn();\r\n            hideZoomClear();\r\n            //interactiveLabels();\r\n            //create an svg for legend container since it's outside of the chart div\r\n            const svg3 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer')\r\n            //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\r\n            const legendBlockVar2 = svg3.append('g'); //another one for overView()\r\n            //enable the enter-zoom in overview state\r\n            //trigger a function with enter. https://stackoverflow.com/questions/40252637/keypress-trigger-a-function-if-specific-pressed\r\n            function checkKey(e) {\r\n              var key = e.which || e.keyCode;\r\n              if(key === 13) zooming();\r\n              showBtn();\r\n              hideBtns();\r\n              removeText(); //on enter zoom, remove old selection text and switch button view\r\n            }\r\n            document.addEventListener(\"keypress\", checkKey);\r\n            //remove old stuff\r\n            svg.selectAll('.hullPath').remove();\r\n            svg.select('rect') //avoid multiple shading rects on top of each other\r\n              .remove();\r\n            d3.selectAll('g.tick') //remove ticks\r\n              .remove();\r\n            d3.selectAll('.circleCenter') //remove circles\r\n              .remove();\r\n            d3.selectAll('.newCircleCenter') //remove highlights\r\n              .remove();\r\n            d3.selectAll('.circleBackground').remove();\r\n            d3.selectAll('path.domain') //remove double scale lines\r\n              .remove();\r\n            d3.selectAll('line').remove();\r\n            d3.selectAll('.annotation-label').remove();\r\n            d3.selectAll('.annotation-rect').remove();\r\n            d3.selectAll('text.axisLabel').remove();\r\n            d3.select('g.brush').remove(); //remove old brush while changing the view\r\n            d3.selectAll('.legendContainer') //remove old legend\r\n              .remove();\r\n            d3.select('#gLegContainer').remove();\r\n            d3.selectAll('#gLegContainer3') //remove legend block from zoomm\r\n              .remove();\r\n            d3.selectAll('#gLegContainer4') //remove legend block from significance view\r\n              .remove();\r\n            labelLayer.selectAll(\"*\") //remove legend block from significance view\r\n              .remove();\r\n            //Append the X Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5).tickSize(-height))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5);\r\n            //Append the Y Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale)\r\n              .ticks(5)\r\n              .tickSize(-width))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function(d) {\r\n                return d === 1 ? d : d.toExponential().replace('1e-', '');\r\n              });\r\n            //lightly color the zero side of the x-axis\r\n            chart.append('rect')\r\n            .attr(\"height\", height)\r\n            .attr('width', xScale(0))\r\n            .attr(\"fill\", \"lightgray\")\r\n            .attr(\"opacity\", 0.2);\r\n            d3.selectAll('g.tick')\r\n            .select('line').style('stroke-width', 0.1).style('opacity', 0.5);\r\n            chart.append('line')\r\n            .attr(\"x1\", 0)\r\n            .attr(\"y1\", yScale(0.0000001))\r\n            .attr(\"x2\", width)\r\n            .attr(\"y2\", yScale(0.0000001))\r\n            .style(\"stroke\", 'grey')\r\n            .style(\"stroke-dasharray\", (\"3, 3\"))\r\n            .style(\"stroke-width\", 0.5);\r\n            //add labels\r\n            chart.append(\"text\")\r\n            .text(\"-log10 p-value\")\r\n            .attr(\"x\", 20)\r\n            .attr(\"y\", height / 1.8)\r\n            .attr(\"transform\", \"translate(-150,150) rotate(-90)\")\r\n            .attr('class', 'axisLabel')\r\n            .style('font-size', '0.4em')\r\n            .style('font-family', 'sans-serif')\r\n            chart.append(\"text\")\r\n            .attr(\"x\", width / 2)\r\n            .attr(\"y\", height * 1.08)\r\n            .attr('class', 'axisLabel')\r\n            .style(\"text-anchor\", \"middle\")\r\n            .text(\"beta value\")\r\n            .style('font-size', '0.4em')\r\n            .style('font-family', 'sans-serif')\r\n              //set up the tooltip\r\n            var tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-5, 0]).html((event, d) => {\r\n              return d.category + '<br>' + '<br>' + d.phenostring + '<br>' + '<br>' + \"p-value: \" + d.pval + \"<br>\" + \"beta value: \" + d.beta + '<br>' + \"cases / controls: \" + d.n_case + ' / ' + d.n_control + '<br>' + 'pip: ' + d.pip\r\n            });\r\n            svg.call(tip);\r\n\r\n\r\n///////////////////--bigger background dots--//////////////////////\r\n\r\n            var g = svg.append('g').attr(\"id\", \"dataPoints\") //make a new g element to which we append circles\r\n              .selectAll('g').data(data).enter().append('g')\r\n            g.append('circle').attr(\"cx\", function(d) {\r\n                return xScale(d.beta) + 40;\r\n              }) //added offset to align beta values\r\n              .attr(\"cy\", function(d) {\r\n                return yScale(d.pval)\r\n              })\r\n              .attr('r', d => sqrtScale(d.n_case))\r\n              .style('pointer-events', 'none') //disable hover effects\r\n              .style('opacity', function(d) {\r\n                if(d.pval >= 0.0000001) {\r\n                  return 'opacity', 0.1\r\n                } else {\r\n                  return 'opacity', 0.2\r\n                }\r\n              }).attr('fill', d => colorScale(colorValue(d))) //color by category\r\n\r\n\r\n///////////////////////////--add dots--////////////////////////////\r\n\r\n            g.append('circle').attr(\"cx\", function(d) {\r\n                return xScale(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                return yScale(d.pval)\r\n              }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', function(d) {\r\n                if(d.pval >= 0.0000001) {\r\n                  return 'opacity', 0.4\r\n                } else {\r\n                  return 'opacity', 1\r\n                }\r\n              }).attr('fill', d => colorScale(colorValue(d)))\r\n\r\n\r\n////////////////////--hover events--////////////////////////////////\r\n\r\n              //tooltip\r\n              .on('mouseover.tip', tip.show, function() {\r\n                d3.select(this).transition().duration('100');\r\n              }).on('mouseout.tip', tip.hide)\r\n              //highlight color\r\n              .on('mouseover.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n              }).on('mouseout.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', function(d) {\r\n                  if(d.pval >= 0.0000001) {\r\n                    return 'opacity', 0.4\r\n                  } else {\r\n                    return 'opacity', 1\r\n                  }\r\n                }).attr('r', 2)\r\n              })\r\n              //add labels on click, mostly credit to Nicola\r\n              .on(\"click\", function(e, d) {\r\n                var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                  y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                //format the case number with a comma separator\r\n                let format = d3.format(',');\r\n                let formattedCases = format(d.n_case);\r\n                const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                label.append(\"line\")\r\n                .attr(\"x1\", 0)\r\n                .attr(\"y1\", -2.5)\r\n                .attr(\"x2\", -10)\r\n                .attr(\"y2\", -10)\r\n                .style(\"stroke-width\", \"0.5px\")\r\n                .style(\"stroke\", \"#d3d3d3\")\r\n                label.append(\"text\")\r\n                .style(\"font-size\", \"5px\")\r\n                .style(\"font-family\", \"sans-serif\")\r\n                .style(\"cursor\", \"grab\")\r\n                .text(d.phenostring)\r\n                .call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //tspan in a separate line\r\n                  .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n              })\r\n              //reset labels on double-click\r\n              .on('dblclick', function() {\r\n                labelLayer.selectAll(\"*\").remove();\r\n              });\r\n\r\n\r\n////////////////////--legends--///////////////////////////////////////\r\n\r\n            newData = data.filter(d => d.pval <= 0.0000001)\r\n              //categoryData = data.filter(d => d.category == 'Diseases marked as autimmune origin')\r\n              //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\r\n            const unique = [];\r\n            newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x));\r\n            //Initialize data\r\n            var chartData = unique;\r\n            //Initialize legend\r\n            var clicked = \"\"\r\n            var legendItemSize = 8;\r\n            var legendSpacing = 20;\r\n            var xOffset = 10;\r\n            var yOffset = 10;\r\n            //var labelsBlock = d3.select('#labels-block')\r\n            var gLeg = legendBlockVar2.selectAll('g').data(chartData).enter().append('g')\r\n            gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\r\n              var x = xOffset;\r\n              var y = yOffset + (legendItemSize + legendSpacing) * i;\r\n              return `translate(${x}, ${y})`;\r\n            })\r\n            gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category)\r\n\r\n\r\n            gLeg.on(\"mouseover.legend\", function(d) {\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                var legendText = this.textContent; //get the text of the legend in a variable\r\n                var HighlightData = data.filter(d => d.category == legendText) //get the data objects associated with the legend\r\n                d3.selectAll('.circleCenter').style('opacity', 0.1) //on any click set all centers to hidemode\r\n                  //.style('pointer-events', 'none')\r\n                  //Append new circles\r\n                var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g')\r\n                g.append('circle').attr(\"cx\", function(d) {\r\n                    return xScale(d.beta) + 40;\r\n                  }).attr(\"cy\", function(d) {\r\n                    return yScale(d.pval)\r\n                  }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d)))\r\n                  //tooltip\r\n                  .on('mouseover.tip', tip.show, function() {\r\n                    d3.select(this).transition().duration('100');\r\n                  }).on('mouseout.tip', tip.hide)\r\n                  //highlight color\r\n                  .on('mouseover.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n                  }).on('mouseout.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2)\r\n                  })\r\n                  //add labels on click, mostly credit to Nicola\r\n                  .on(\"click\", function(e, d) {\r\n                    var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                      y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                    //format the case number with a comma separator\r\n                    let format = d3.format(',');\r\n                    let formattedCases = format(d.n_case);\r\n                    const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                    label.append(\"line\")\r\n                    .attr(\"x1\", 0)\r\n                    .attr(\"y1\", -2.5)\r\n                    .attr(\"x2\", -10)\r\n                    .attr(\"y2\", -10)\r\n                    .style(\"stroke-width\", \"0.5px\")\r\n                    .style(\"stroke\", \"#d3d3d3\")\r\n                    label.append(\"text\")\r\n                    .style(\"font-size\", \"5px\")\r\n                    .style(\"font-family\", \"sans-serif\")\r\n                    .style(\"cursor\", \"grab\")\r\n                    .text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                      //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                    label.append(\"text\")\r\n                    .style(\"font-size\", \"5px\")\r\n                    .style(\"font-family\", \"sans-serif\")\r\n                    .text('')\r\n                    .call(d3.drag().on(\"start\", dragLabelStarted))\r\n                      //tspan in a separate line\r\n                      .append('tspan')\r\n                      .style(\"cursor\", \"grab\")\r\n                      .style(\"font-size\", \"5px\")\r\n                      .style(\"font-family\", \"sans-serif\")\r\n                      .attr('dy', '7px')\r\n                      .attr('dx', '0px')\r\n                      .text('Cases: ' + formattedCases)\r\n                      .call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  })\r\n                  //reset labels on double-click\r\n                  .on('dblclick', function() {\r\n                    labelLayer.selectAll(\"*\").remove();\r\n                  });\r\n                //highlight selected gLeg group\r\n                d3.selectAll(gLeg).style('opacity', 0.5)\r\n                d3.select(this).style('opacity', 1);\r\n              }) //end of click\r\n              //double-click anywhere on the labels block\r\n            var labelsBlock = d3.select('#labels-block')\r\n            labelsBlock.on('mouseout.legend', function(d) {\r\n                //reset circlecenter opacity\r\n                d3.selectAll('.circleCenter').style('opacity', function(d) {\r\n                    if(d.pval >= 0.0000001) {\r\n                      return 'opacity', 0.4\r\n                    } else {\r\n                      return 'opacity', 1\r\n                    }\r\n                  })\r\n                  //remove highlights\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                //legend items back to full opacity\r\n                d3.selectAll(gLeg).style('opacity', 1);\r\n              })\r\n              \r\n\r\n//////////////////////--brushing--/////////////////////////\r\n\r\n              //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\r\n              //const selection2 = [];//an empty array where we can push data\r\n            const brush = d3.brush().extent([\r\n              [0, 0],\r\n              [width, height]\r\n            ]); //stay within the chart and above the significance\r\n            //attach the brush to the chart\r\n            const gBrush = chart.append('g').attr('class', 'brush').call(brush);\r\n            //column setup for the brushed data\r\n            const table = d3.select('#info-column');\r\n            const categoryCol = d3.select('#category');\r\n            const phenoCol = d3.select('#phenotype');\r\n            const pvalCol = d3.select('#pval');\r\n            const betaCol = d3.select('#beta');\r\n            const caseCol = d3.select('#case-control');\r\n            //brush event inside the overview state\r\n            brush.on('end', function(event, d) {\r\n              const selection = event.selection; //the scope of the brush\r\n              d3.selectAll('circle').each(function(d) { //go through the points\r\n                  //condition: stay within the brush rect\r\n                  if(selection && yScale(d.pval) > selection[0][1] && yScale(d.pval) < selection[1][1] && xScale(d.beta) > selection[0][0] && xScale(d.beta) < selection[1][0]) {\r\n                    selection2.push(d) //push data to the empty array\r\n                  }\r\n                })\r\n                //function to remove duplicate values from the array\r\n              function removeDuplicates(selection2) {\r\n                return selection2.filter((value, index) => selection2.indexOf(value) === index);\r\n              }\r\n              //console.log(removeDuplicates(selection2))\r\n              categoryCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).attr('margin-top', function(d, i) {\r\n                if('overflow-x' == true) {\r\n                  return -3;\r\n                }\r\n              }).html(function(d) {\r\n                return d.category;\r\n              })\r\n              phenoCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.phenostring;\r\n              })\r\n              pvalCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.pval;\r\n              })\r\n              betaCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.beta;\r\n              })\r\n              caseCol.selectAll('p').data((removeDuplicates(selection2))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.n_case + ' / ' + d.n_control;\r\n              })\r\n            });\r\n            //hide the convex hull\r\n            function hideHull() {\r\n              svg.selectAll('.hullPath').remove();\r\n              //still need to remove the checkmark from the box on toggle\r\n            }\r\n            function removeText() { //remove texts tagged with 'info' class\r\n              d3.selectAll('p.info').remove();\r\n            }\r\n            \r\n\r\n///////////////////--highlight pip--//////////////////////\r\n\r\n            var subset = data.filter(d => d.pip >= 0.1); //pip values bigger or equal to 0.1\r\n            var subset2 = data.filter(d => d.pip > 0 && d.pip < 0.1); //pip values bigger than zero but smaller than 0.1\r\n            //console.log(subset2)//subset 2 doesn't have anything for this dataset apparently\r\n            function showPip() {\r\n              svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n                return xScale(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                return yScale(d.pval)\r\n              }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\r\n            }\r\n\r\n            function showSmallPip() {\r\n              svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n                return xScale(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                return yScale(d.pval)\r\n              }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\r\n            }\r\n            //for significant ones\r\n            function showPip2() {\r\n              svg.selectAll(\".dot\").data(subset).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n                return xScale2(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                if(d.pval <= 0.0000001) {\r\n                  return yScale3(d.pval)\r\n                }\r\n              }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\r\n            }\r\n\r\n            function showSmallPip2() {\r\n              svg.selectAll(\".dot\").data(subset2).enter().append(\"circle\").attr('r', 2).attr('class', 'pipdot').attr(\"cx\", function(d) {\r\n                return xScale2(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                if(d.pval <= 0.0000001) {\r\n                  return yScale3(d.pval)\r\n                }\r\n              }).style(\"fill\", d => colorScale(colorValue(d))).style('stroke', 'black').style('opacity', 1).style('pointer-events', 'none');\r\n            }\r\n\r\n            function hidePip() {\r\n              d3.selectAll('circle.pipdot').remove();\r\n            }\r\n            labelLayer.raise();\r\n\r\n            /////////////////////--csv download--///////////////////////////\r\n function downloadCsv() {\r\n  //function to remove duplicate values from the array\r\n  function removeDuplicates(selection2) {\r\n    return selection2.filter((value, index) => selection2.indexOf(value) === index);\r\n  }\r\n  //make the header\r\n  var data_export_csv_header = Object.keys(selection2[0]).join(), //gets data keys as strings\r\n    rows = removeDuplicates(selection2);\r\n  //this is the core\r\n  var data_export_csv_rows = rows.map(function(el) {\r\n      return Object.values(el).join()\r\n    }).join('\\n');\r\n  var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\r\n  /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\r\n  var blob = new Blob([data_export_csv]);\r\n  if(window.navigator.msSaveOrOpenBlob) {\r\n    window.navigator.msSaveBlob(blob, \"tableData.csv\");\r\n  } else {\r\n    var a = window.document.createElement(\"a\"); //empty element(link)\r\n    a.href = window.URL.createObjectURL(blob, {\r\n      type: \"text/plain\"\r\n    });\r\n    //console.log(a.href, 'ciao');\r\n    a.download = \"tableData.csv\";\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  }\r\n}\r\n\r\ndocument.getElementById('button_styled_download').onclick = function() {\r\n  return downloadCsv();\r\n};\r\n          } //end of overview\r\n\r\n\r\n/////////////////////////////////////////////////////////////////////////\r\n//////////////////--show significant ones function--////////////////////\r\n/////////////////////////////////////////////////////////////////////////\r\n\r\n          function redrawScale() { //despite the name redraw both the scales and the dots based on pval being smaller than 0.0000001\r\n            newData = data.filter(d => d.pval <= 0.0000001)\r\n            removeText();\r\n            resetDiv();\r\n            //interactiveLabels();\r\n            //remove old stuff\r\n            svg.selectAll('.hullPath').remove();\r\n            d3.selectAll('circle').remove();\r\n            d3.selectAll('g.tick').remove();\r\n            d3.selectAll('path.domain') //remove double scale lines\r\n              .remove();\r\n            d3.selectAll('line').remove();\r\n            d3.selectAll('.annotation-label').remove();\r\n            d3.selectAll('.annotation-rect').remove();\r\n            /*d3.selectAll('.legendContainer')\r\n              .remove();*/\r\n            d3.select('#gLegContainer').remove();\r\n            d3.select('rect').remove();\r\n            d3.select('#gLegContainer2').remove();\r\n            d3.select('g.brush').remove(); //remove old brush while changing the view\r\n            //clear label layer\r\n            labelLayer.selectAll(\"*\").remove()\r\n              //Append the new X Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale2).ticks(5).tickSize(-height))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5);\r\n            //Append the new Y Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale3).ticks(3).tickSize(-width))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function(d) {\r\n                return d === 1 ? d : d.toExponential().replace('1e-', '');\r\n              });\r\n            //style the tick lines\r\n            d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5);\r\n          //lightly color the zero side of the x-axis\r\n          chart.append('rect')\r\n          .attr(\"height\", height)\r\n          .attr('width', xScale2(0))\r\n          .attr(\"fill\", \"lightgray\")\r\n          .attr(\"opacity\", 0.2);\r\n\r\n            //Append new circles\r\n            var g = svg.append('g').selectAll('g').data(newData).enter().append('g')\r\n            g.append('circle').attr(\"cx\", function(d) {\r\n                return xScale2(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                return yScale3(d.pval)\r\n              }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d)))\r\n              //tooltip\r\n              .on('mouseover.tip', tip.show, function() {\r\n                d3.select(this).transition().duration('100');\r\n              }).on('mouseout.tip', tip.hide)\r\n              //highlight color\r\n              .on('mouseover.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n              }).on('mouseout.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', function(d) {\r\n                  if(d.pval >= 0.0000001) {\r\n                    return 'opacity', 0.4\r\n                  } else {\r\n                    return 'opacity', 1\r\n                  }\r\n                }).attr('r', 2)\r\n              })\r\n              //add labels on click, mostly credit to Nicola\r\n              .on(\"click\", function(e, d) {\r\n                var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                  y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                //format the case number with a comma separator\r\n                let format = d3.format(',');\r\n                let formattedCases = format(d.n_case);\r\n                const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\")\r\n                label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //tspan in a separate line\r\n                  .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n              })\r\n              //reset labels on double-click\r\n              .on('dblclick', function() {\r\n                labelLayer.selectAll(\"*\").remove();\r\n              });\r\n            //bigger circles\r\n            g.append('circle').attr(\"id\", \"dataPoints\").attr(\"cx\", function(d) {\r\n                return xScale2(d.beta) + 40;\r\n              }) //added offset to align beta values\r\n              .attr(\"cy\", function(d) {\r\n                return yScale3(d.pval)\r\n              }).attr('r', d => sqrtScale(d.n_case)).style('pointer-events', 'none') //disable hover effects\r\n              .attr('class', 'circleBackground').style('opacity', 0.2).attr('fill', d => colorScale(colorValue(d))) //color by category\r\n              //brushing significant ones, help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\r\n            const brush = d3.brush().extent([\r\n              [0, 0],\r\n              [width, height]\r\n            ]); //stay within the chart and above the significance\r\n            const gBrush = chart.append('g').attr('class', 'brush').call(brush);\r\n            //column setup for the brushed data\r\n            const table = d3.select('#info-column');\r\n            const categoryCol = d3.select('#category');\r\n            const phenoCol = d3.select('#phenotype');\r\n            const pvalCol = d3.select('#pval');\r\n            const betaCol = d3.select('#beta');\r\n            const caseCol = d3.select('#case-control');\r\n\r\n\r\n//////////////////--legends--//////////////////////////////////////////\r\n            //significant ones label block\r\n            //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\r\n            const unique = [];\r\n            newData.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x));\r\n            //console.log(unique);\r\n            //Initialize data\r\n            var chartData = unique;\r\n            //Initialize legend\r\n            var legendItemSize = 8;\r\n            var legendSpacing = 20;\r\n            var xOffset = 10;\r\n            var yOffset = 10;\r\n            //create an svg for legend container since it's outside of the chart div\r\n            const svg5 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer')\r\n            //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\r\n            const legendBlockVar4 = svg5.append('g'); //another one for zooming()\r\n            var gLeg = legendBlockVar4.selectAll('g').data(chartData).enter().append('g')\r\n            gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\r\n              var x = xOffset;\r\n              var y = yOffset + (legendItemSize + legendSpacing) * i;\r\n              return `translate(${x}, ${y})`;\r\n            })\r\n            gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category)\r\n            gLeg.on(\"mouseover.legend\", function(d) {\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                var legendText = this.textContent; //get the text of the legend in a variable\r\n                var HighlightData = newData.filter(d => d.category == legendText) //get the data objects associated with the legend\r\n                d3.selectAll('.circleCenter').style('opacity', 0.1) //on any click set all centers to hidemode\r\n                  //.style('pointer-events', 'none')\r\n                  //Append new circles\r\n                var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g')\r\n                g.append('circle').attr(\"cx\", function(d) {\r\n                    return xScale2(d.beta) + 40;\r\n                  }).attr(\"cy\", function(d) {\r\n                    return yScale3(d.pval)\r\n                  }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d)))\r\n                  //tooltip\r\n                  .on('mouseover.tip', tip.show, function() {\r\n                    d3.select(this).transition().duration('100');\r\n                  }).on('mouseout.tip', tip.hide)\r\n                  //highlight color\r\n                  .on('mouseover.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n                  }).on('mouseout.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2)\r\n                  })\r\n                  //add labels on click, mostly credit to Nicola\r\n                  .on(\"click\", function(e, d) {\r\n                    var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                      y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                    //format the case number with a comma separator\r\n                    let format = d3.format(',');\r\n                    let formattedCases = format(d.n_case);\r\n                    const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                    label.append(\"line\").attr(\"x1\", 0).attr(\"y1\", -2.5).attr(\"x2\", -10).attr(\"y2\", -10).style(\"stroke-width\", \"0.5px\").style(\"stroke\", \"#d3d3d3\")\r\n                    label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").style(\"cursor\", \"grab\").text(d.phenostring).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                      //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                    label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                      //tspan in a separate line\r\n                      .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  })\r\n                  //reset labels on double-click\r\n                  .on('dblclick', function() {\r\n                    labelLayer.selectAll(\"*\").remove();\r\n                  });\r\n                //highlight selected gLeg group\r\n                d3.selectAll(gLeg).style('opacity', 0.5)\r\n                d3.select(this).style('opacity', 1);\r\n              }) //end of click\r\n              //double-click anywhere on the labels block\r\n            var labelsBlock = d3.select('#labels-block')\r\n            labelsBlock.on('mouseout.legend', function(d) {\r\n                //reset circlecenter opacity\r\n                d3.selectAll('.circleCenter').style('opacity', function(d) {\r\n                    if(d.pval >= 0.0000001) {\r\n                      return 'opacity', 0.4\r\n                    } else {\r\n                      return 'opacity', 1\r\n                    }\r\n                  })\r\n                  //remove highlights\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                //legend items back to full opacity\r\n                d3.selectAll(gLeg).style('opacity', 1);\r\n              })\r\n\r\n\r\n////////////////////////////////////////////////////////////////////\r\n            //brush event\r\n            brush.on('end', function(event, d) {\r\n              const selection = event.selection; //the scope of the brush\r\n              d3.selectAll('circle').each(function(d) { //go through the points\r\n                  //condition: stay within the brush rect\r\n                  if(selection && yScale3(d.pval) > selection[0][1] && yScale3(d.pval) < selection[1][1] && xScale2(d.beta) > selection[0][0] && xScale2(d.beta) < selection[1][0]) {\r\n                    selection3.push(d) //push data to the empty array\r\n                  }\r\n                })\r\n                //function to remove duplicate values from the array\r\n              function removeDuplicates2(selection2) {\r\n                return selection3.filter((value, index) => selection3.indexOf(value) === index);\r\n              }\r\n              categoryCol.selectAll('p').data((removeDuplicates2(selection3))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).attr('margin-top', function(d, i) {\r\n                if('overflow-x' == true) {\r\n                  return -3;\r\n                }\r\n              }).html(function(d) {\r\n                return d.category;\r\n              })\r\n              phenoCol.selectAll('p').data((removeDuplicates2(selection3))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.phenostring;\r\n              })\r\n              pvalCol.selectAll('p').data((removeDuplicates2(selection3))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.pval;\r\n              })\r\n              betaCol.selectAll('p').data((removeDuplicates2(selection3))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.beta;\r\n              })\r\n              caseCol.selectAll('p').data((removeDuplicates2(selection3))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.n_case + ' / ' + d.n_control;\r\n              })\r\n            });\r\n\r\n            function removeText() { //remove texts tagged with 'info' class\r\n              d3.selectAll('p.info').remove();\r\n            }\r\n            labelLayer.raise();\r\n\r\n              /////////////////////--csv download--///////////////////////////\r\n function downloadCsv() {\r\n  //function to remove duplicate values from the array\r\n  function removeDuplicates(selection3) {\r\n    return selection3.filter((value, index) => selection3.indexOf(value) === index);\r\n  }\r\n  //make the header\r\n  var data_export_csv_header = Object.keys(selection3[0]).join(), //gets data keys as strings\r\n    rows = removeDuplicates(selection3);\r\n  //this is the core\r\n  var data_export_csv_rows = rows.map(function(el) {\r\n      return Object.values(el).join()\r\n    }).join('\\n');\r\n  var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\r\n  /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\r\n  var blob = new Blob([data_export_csv]);\r\n  if(window.navigator.msSaveOrOpenBlob) {\r\n    window.navigator.msSaveBlob(blob, \"tableData.csv\");\r\n  } else {\r\n    var a = window.document.createElement(\"a\"); //empty element(link)\r\n    a.href = window.URL.createObjectURL(blob, {\r\n      type: \"text/plain\"\r\n    });\r\n    //console.log(a.href, 'ciao');\r\n    a.download = \"tableData.csv\";\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  }\r\n}\r\n\r\ndocument.getElementById('button_styled_download').onclick = function() {\r\n  return downloadCsv();\r\n};\r\n\r\n} //end of redraw\r\n\r\n\r\n/////////////////////////////////////////////////////\r\n//////////////////--simple zoom----//////////////////\r\n////////////////////////////////////////////////////\r\n\r\n          function zooming() {\r\n\r\n\r\n            showZoomClear();\r\n            resetDiv();//reset the legend block\r\n            //remove old stuff\r\n            svg.selectAll('.hullPath') //remove hull if there is one\r\n              .remove();\r\n            svg.selectAll('rect').remove();\r\n            d3.selectAll('circle') //remove old circles\r\n              .remove();\r\n            d3.selectAll('g.tick') //remove old ticks from old scales\r\n              .remove();\r\n            d3.selectAll('path.domain') //remove double scale lines\r\n              .remove();\r\n            d3.select('g.brush') //remove old brush square\r\n              .remove();\r\n            //remove annotations\r\n            d3.selectAll('.annotation-label').remove();\r\n            d3.selectAll('.annotation-rect').remove();\r\n            d3.selectAll('.legendContainer') //remove old legends\r\n              .remove();\r\n            d3.selectAll('#gLegContainer').remove();\r\n            d3.selectAll('#gLegContainer2').remove();\r\n            d3.selectAll('#gLegContainer3').remove();\r\n            d3.selectAll('line').remove();\r\n            //clear label layer\r\n            labelLayer.selectAll(\"*\").remove()\r\n            //create an svg for legend container since it's outside of the chart div\r\n            const svg4 = d3.select('#labels-block').append('svg').attr('id', 'gLegContainer')\r\n            //.attr(\"width\", 500).attr(\"height\", height * 2.1); //width and height of the inner svg, doesn't affect the div\r\n            const legendBlockVar3 = svg4.append('g'); //another one for zooming()\r\n            //get min and max p values from selection for zooming\r\n            var pMax2 = d3.max(selection2, function(d) {\r\n              return d.pval;\r\n            });\r\n            var pMin2 = d3.min(selection2, function(d) {\r\n              return d.pval;\r\n            })\r\n            var yScale4 = d3.scaleLog().domain([pMin2 - (pMin2 / 1.001), pMax2 + (pMax2 * 2)]).range([0, height]).nice();\r\n            //get min and max beta from selection for zooming\r\n            var betaMax3 = d3.max(selection2, function(d) {\r\n              return d.beta;\r\n            });\r\n            var betaMin3 = d3.min(selection2, function(d) {\r\n              return d.beta;\r\n            });\r\n            var xScale3 = d3.scaleLinear()\r\n              //.domain([betaMin3-(betaMax3),betaMax3+(betaMin3*(-1))])\r\n              .domain([betaMin3-0.1, betaMax3+0.1]).range([0, width]);\r\n            //Append the new X Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(xScale3).ticks(5, '.2f').tickSize(-height))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5);\r\n            //Append the new Y Axis\r\n            chart.append(\"g\").attr(\"transform\", `translate(0, 0)`).call(d3.axisLeft(yScale4).tickSize(-width).tickArguments([5, \".0f\"]))\r\n              //adjust tick labels\r\n              .selectAll('text').style('font-size', '0.5em').style('opacity', 0.5).text(function(d) {\r\n                return d === 1 ? d : d.toExponential().replace('1e-', '');\r\n              });\r\n            //style the tick lines\r\n            d3.selectAll('g.tick').select('line').style('stroke-width', 0.1).style('opacity', 0.5);\r\n            //lightly color the zero side of the x-axis\r\n          chart.append('rect')\r\n          .attr(\"height\", height)\r\n          .attr('width', xScale3(0))\r\n          .attr(\"fill\", \"lightgray\")\r\n          .attr(\"opacity\", 0.2);\r\n\r\n            var g = svg.append('g') //make a new g element to which we append circles\r\n              .selectAll('g').data(selection2).enter().append('g')\r\n            g.append('circle').attr(\"cx\", function(d) {\r\n                return xScale3(d.beta) + 40;\r\n              }).attr(\"cy\", function(d) {\r\n                return yScale4(d.pval)\r\n              }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'circleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', function(d) {\r\n                if(d.pval >= 0.0000001) {\r\n                  return 'opacity', 0.4\r\n                } else {\r\n                  return 'opacity', 1\r\n                }\r\n              }).attr('fill', d => colorScale(colorValue(d)))\r\n              //tooltip\r\n              .on('mouseover.tip', tip.show, function() {\r\n                d3.select(this).transition().duration('100');\r\n              }).on('mouseout.tip', tip.hide)\r\n              //highlight color\r\n              .on('mouseover.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n              }).on('mouseout.color', function() {\r\n                d3.select(this).transition().duration('200').style('opacity', function(d) {\r\n                  if(d.pval >= 0.0000001) {\r\n                    return 'opacity', 0.4\r\n                  } else {\r\n                    return 'opacity', 1\r\n                  }\r\n                }).attr('r', 2)\r\n              })\r\n              //add labels on click, mostly credit to Nicola\r\n              .on(\"click\", function(e, d) {\r\n                var x = parseFloat(d3.select(this).attr(\"cx\")),\r\n                  y = parseFloat(d3.select(this).attr(\"cy\"));\r\n                //format the case number with a comma separator\r\n                let format = d3.format(',');\r\n                let formattedCases = format(d.n_case);\r\n                const label = labelLayer.append(\"g\").classed(\"chartLabel\", true).style(\"transform\", `translate(${x+10}px,${y+10}px)`);\r\n                label.append(\"line\")\r\n                .attr(\"x1\", 0)\r\n                .attr(\"y1\", -2.5)\r\n                .attr(\"x2\", -10)\r\n                .attr(\"y2\", -10)\r\n                .style(\"stroke-width\", \"0.5px\")\r\n                .style(\"stroke\", \"#d3d3d3\")\r\n                label.append(\"text\")\r\n                .style(\"font-size\", \"5px\")\r\n                .style(\"font-family\", \"sans-serif\")\r\n                .style(\"cursor\", \"grab\")\r\n                .text(d.phenostring)\r\n                .call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //I'm sure this can be worked in another way, but appended an empty string where to append the tspan: empty string allows us to always translate to the correct x-point without worrting anbout the lenght of the first string \r\n                label.append(\"text\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").text('').call(d3.drag().on(\"start\", dragLabelStarted))\r\n                  //tspan in a separate line\r\n                  .append('tspan').style(\"cursor\", \"grab\").style(\"font-size\", \"5px\").style(\"font-family\", \"sans-serif\").attr('dy', '7px').attr('dx', '0px').text('Cases: ' + formattedCases).call(d3.drag().on(\"start\", dragLabelStarted))\r\n              })\r\n              //reset labels on double-click\r\n              .on('dblclick', function() {\r\n                labelLayer.selectAll(\"*\").remove();\r\n              });\r\n            //bigger background dots\r\n            g.append('circle').attr(\"id\", \"dataPoints\").attr(\"cx\", function(d) {\r\n                return xScale3(d.beta) + 40;\r\n              }) //added offset to align beta values\r\n              .attr(\"cy\", function(d) {\r\n                return yScale4(d.pval)\r\n              }).attr('r', d => sqrtScale(d.n_case))\r\n              .style('pointer-events', 'none') //disable hover effects\r\n              .attr('class', 'circleBackground').style('opacity', function(d) {\r\n                if(d.pval >= 0.0000001) {\r\n                  return 'opacity', 0.1\r\n                } else {\r\n                  return 'opacity', 0.2\r\n                }\r\n              }).attr('fill', d => colorScale(colorValue(d))) //color by category\r\n            g.append('line').attr(\"x1\", 40).attr(\"y1\", function(d) {\r\n              if(d.pval > 0.0000001) {\r\n                return yScale4(0.0000001)\r\n              }\r\n            }).attr(\"x2\", width + 40).attr(\"y2\", function(d) {\r\n              if(d.pval > 0.0000001) {\r\n                return yScale4(0.0000001)\r\n              }\r\n            }).style(\"stroke\", 'grey').style(\"stroke-dasharray\", (\"3, 3\")).style(\"stroke-width\", 0.3);\r\n            //help from https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/\r\n            const brush = d3.brush().extent([\r\n              [0, 0],\r\n              [width, height]\r\n            ]); //stay within the chart\r\n            //attach the brush to the chart\r\n            const gBrush = chart.append('g').attr('class', 'brush').call(brush);\r\n            ////////////////////////////////////////////////////////////\r\n            //https://wsvincent.com/javascript-remove-duplicates-array/, this method found from the chat belove the post\r\n            const unique = [];\r\n            selection2.map(x => unique.filter(a => a.category == x.category && a.category == x.category).length > 0 ? null : unique.push(x));\r\n            //Initialize data\r\n            var chartData = unique;\r\n            //Initialize legend\r\n            var legendItemSize = 8;\r\n            var legendSpacing = 20;\r\n            var xOffset = 10;\r\n            var yOffset = 10;\r\n            var gLeg = legendBlockVar3.selectAll('g').data(chartData).enter().append('g')\r\n            gLeg.append('circle').style('fill', d => colorScale(colorValue(d))).attr('r', legendItemSize).attr('transform', (d, i) => {\r\n              var x = xOffset;\r\n              var y = yOffset + (legendItemSize + legendSpacing) * i;\r\n              return `translate(${x}, ${y})`;\r\n            })\r\n            gLeg.append('text').attr('class', 'label').attr('x', xOffset + legendItemSize + 5).attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 5).text(d => d.category)\r\n              ////////////////////////////////////////////////////////////////////\r\n              //attaching click to the legend text for now\r\n            gLeg.on(\"mouseover.legend\", function(d) {\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                var legendText = this.textContent; //get the text of the legend in a variable\r\n                var HighlightData = selection2.filter(d => d.category == legendText) //get the data objects associated with the legend\r\n                d3.selectAll('.circleCenter').style('opacity', 0.1) //on any click set all centers to hidemode\r\n                  //.style('pointer-events', 'none')\r\n                  //Append new circles\r\n                var g = svg.append('g').selectAll('g').data(HighlightData).enter().append('g')\r\n                g.append('circle').attr(\"cx\", function(d) {\r\n                    return xScale3(d.beta) + 40;\r\n                  }).attr(\"cy\", function(d) {\r\n                    return yScale4(d.pval)\r\n                  }).attr('fill', d => colorScale(colorValue(d))).attr('class', 'newCircleCenter').attr('r', 2).attr('stroke', 'white').attr('opacity', 1).attr('fill', d => colorScale(colorValue(d)))\r\n                  //tooltip\r\n                  .on('mouseover.tip', tip.show, function() {\r\n                    d3.select(this).transition().duration('100');\r\n                  }).on('mouseout.tip', tip.hide)\r\n                  //highlight color\r\n                  .on('mouseover.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', d => sqrtScale(d.n_case))\r\n                  }).on('mouseout.color', function() {\r\n                    d3.select(this).transition().duration('200').style('opacity', 1).attr('r', 2)\r\n                  })\r\n                  //highlight selected gLeg group\r\n                d3.selectAll(gLeg).style('opacity', 0.5)\r\n                d3.select(this).style('opacity', 1);\r\n              }) //end of click\r\n              //double-click anywhere on the labels block\r\n            var labelsBlock = d3.select('#labels-block')\r\n            labelsBlock.on('mouseout.legend', function(d) {\r\n                //reset circlecenter opacity\r\n                d3.selectAll('.circleCenter').style('opacity', function(d) {\r\n                    if(d.pval >= 0.0000001) {\r\n                      return 'opacity', 0.4\r\n                    } else {\r\n                      return 'opacity', 1\r\n                    }\r\n                  })\r\n                  //remove highlights\r\n                d3.selectAll('.newCircleCenter').remove();\r\n                //legend items back to full opacity\r\n                d3.selectAll(gLeg).style('opacity', 1);\r\n              })\r\n              //column setup for the brushed data\r\n            const categoryCol = d3.select('#category');\r\n            const phenoCol = d3.select('#phenotype');\r\n            const pvalCol = d3.select('#pval');\r\n            const betaCol = d3.select('#beta');\r\n            const caseCol = d3.select('#case-control');\r\n            //brush event\r\n            brush.on('end', function(event, d) {\r\n              const selection = event.selection; //the scope of the brush\r\n              d3.selectAll('circle').each(function(d) { //go through the points\r\n                  if(selection && yScale4(d.pval) > selection[0][1] && yScale4(d.pval) < selection[1][1] && xScale3(d.beta) > selection[0][0] && xScale3(d.beta) < selection[1][0]) {\r\n                    selection4.push(d) //push data to the empty array\r\n                  }\r\n                })\r\n                //function to remove duplicate values from the array\r\n              function removeDuplicates3(selection4) {\r\n                return selection4.filter((value, index) => selection4.indexOf(value) === index);\r\n              }\r\n              //console.log(removeDuplicates3(selection4));\r\n              /*new values to table from selection 4*/\r\n              categoryCol.selectAll('p').data((removeDuplicates3(selection4))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).attr('margin-top', function(d, i) {\r\n                if('overflow-x' == true) {\r\n                  return -3;\r\n                }\r\n              }).html(function(d) {\r\n                return d.category;\r\n              })\r\n              phenoCol.selectAll('p').data((removeDuplicates3(selection4))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').attr('id', 'row').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.phenostring;\r\n              })\r\n              pvalCol.selectAll('p').data((removeDuplicates3(selection4))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.pval;\r\n              })\r\n              betaCol.selectAll('p').data((removeDuplicates3(selection4))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.beta;\r\n              })\r\n              caseCol.selectAll('p').data((removeDuplicates3(selection4))).enter().append('div').attr('data-simplebar', 'init').style('overflow-x', 'auto').append('p').attr('class', 'info').attr('x', 10).attr('y', function(d, i) {\r\n                return i * 12;\r\n              }).html(function(d) {\r\n                return d.n_case + ' / ' + d.n_control;\r\n              })\r\n            })\r\n            labelLayer.raise();\r\n\r\n            function downloadCsvZoom() {\r\n              //function to remove duplicate values from the array\r\n              function removeDuplicates3(selection4) {\r\n                return selection4.filter((value, index) => selection4.indexOf(value) === index);\r\n              }\r\n              //make the header\r\n              var data_export_csv_header = Object.keys(selection4[0]).join(), //gets data keys as strings\r\n                rows = removeDuplicates3(selection4);\r\n              //this is the core\r\n              var data_export_csv_rows = rows.map(function(el) {\r\n                  return Object.values(el).join()\r\n                }).join('\\n');\r\n              var data_export_csv = data_export_csv_header + '\\n' + data_export_csv_rows; //join header and rows\r\n              /*https://riptutorial.com/javascript/example/24711/client-side-csv-download-using-blob*/\r\n              var blob = new Blob([data_export_csv]);\r\n              if(window.navigator.msSaveOrOpenBlob) {\r\n                window.navigator.msSaveBlob(blob, \"tableData.csv\");\r\n              } else {\r\n                var a = window.document.createElement(\"a\"); //empty element(link)\r\n                a.href = window.URL.createObjectURL(blob, {\r\n                  type: \"text/plain\"\r\n                });\r\n                //console.log(a.href, 'ciao');\r\n                a.download = \"tableData.csv\";\r\n                document.body.appendChild(a);\r\n                a.click();\r\n                document.body.removeChild(a);\r\n              }\r\n            }\r\n\r\n            document.getElementById('button_styled_download_zoom').onclick = function() {\r\n              return downloadCsvZoom();\r\n            };\r\n            console.log(selection4);\r\n          } //end of zoom\r\n\r\n\r\n\r\n          //hide the convex hull\r\n          function hideHull() {\r\n            svg.selectAll('.hullPath').remove();\r\n          }\r\n\r\n          function removeBrush2() { //remove brush selection\r\n            selection3.length = 0;\r\n          }\r\n\r\n          function removeBrush3() { //remove brush selection\r\n            selection4.length = 0;\r\n          }\r\n          const labelLayer = svg.append('g').attr(\"id\", \"labelLayer\")\r\n\r\n          function dragLabelStarted(event) {\r\n            const label = d3.select(this.parentNode);\r\n            event.on(\"drag\", dragged).on(\"end\", ended);\r\n\r\n            function dragged(event) {\r\n              label.select(\"line\").raise().attr(\"x1\", event.x).attr(\"y1\", event.y - 2.5);\r\n              label.select(\"text\").raise().attr(\"x\", event.x).attr(\"y\", event.y).style(\"cursor\", \"grabbing\");\r\n            }\r\n\r\n            function ended() {\r\n              label.select(\"text\").style(\"cursor\", \"grab\");\r\n            }\r\n          } //end of label drag\r\n\r\n          //const [ciao,setCiao] = useState ('ciao!') \r\n\r\n       } //end bracket for lavaa function\r\n       volcano(props);\r\n      }\r\n  });   \r\n\r\nfunction downloadImgClick() {\r\n  myToggle();\r\n  downloadImg();\r\n}\r\n\r\n//hide download option buttons\r\n  function hideDownloadOptions() {\r\n    var show = document.getElementById('download-options');\r\n    show.style.display = 'none';\r\n  }\r\n\r\n//toggle download button\r\nfunction myToggle() {\r\n  var x = document.getElementById(\"download-options\");\r\n  if(x.style.display === \"none\") {\r\n    x.style.display = \"block\";\r\n  } else {\r\n    x.style.display = \"none\";\r\n  }\r\n}\r\n\r\n/////////////////////--image download by Nicola--////////////////\r\nfunction downloadImg() {\r\n  //show options\r\n  //d3.select(\"#download-options\").style(\"display\",\"block\")\r\n  /* PREPARE SVG DOWNLOAD BUTTON */\r\n  //get svg element.\r\n  var svg = d3.select(\"#chart\").select(\"svg\").node();\r\n  var headline = d3.select(\"#headline-block\").select(\"text\").node();\r\n  //console.log(headline)\r\n    //get svg source.\r\n  var serializer = new XMLSerializer();\r\n  var source = serializer.serializeToString(svg);\r\n  //add name spaces.\r\n  if(!source.match(/^<svg[^>]+xmlns=\"http\\:\\/\\/www\\.w3\\.org\\/2000\\/svg\"/)) {\r\n    source = source.replace(/^<svg/, '<svg xmlns=\"http://www.w3.org/2000/svg\"');\r\n  }\r\n  if(!source.match(/^<svg[^>]+\"http\\:\\/\\/www\\.w3\\.org\\/1999\\/xlink\"/)) {\r\n    source = source.replace(/^<svg/, '<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\"');\r\n  }\r\n  //add xml declaration\r\n  source = '<?xml version=\"1.0\" standalone=\"no\"?>\\r\\n' + source;\r\n  //convert svg source to URI data scheme.\r\n  var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(source);\r\n  //set url value to a element's href attribute.\r\n  document.getElementById(\"downloadSvg\").href = url;\r\n  //you can download svg file by right click menu.\r\n  let svgWithBg = d3.select(\"#chart\").select(\"svg\").style(\"background-color\", \"white\").node()\r\n  var svgString = new XMLSerializer().serializeToString(svgWithBg);\r\n  // var DOMURL = window.location.pathname; // invalid request\r\n  var img = new Image();\r\n  var svgAbs = new Blob([svgString], {\r\n    type: \"image/svg+xml;charset=utf-8\"\r\n  });\r\n  var url = URL.createObjectURL(svgAbs);\r\n  img.onload = function() {\r\n    let canvas = document.createElement('canvas')\r\n    canvas.height = 750;\r\n    canvas.width = 799.5;\r\n    var ctx = canvas.getContext(\"2d\");\r\n    ctx.drawImage(img, 0, 0, 799.5, 800);\r\n    // var jpg = canvas.toDataURL(\"image/jpeg\",1.0);\r\n    // DOMURL.revokeObjectURL(jpg);\r\n    var image = canvas.toDataURL(\"image/jpeg\", 1.0);\r\n    document.getElementById(\"downloadJpeg\").href = image;\r\n  };\r\n  img.src = url;\r\n}\r\n\r\nconst selection2 = []; //an empty array where we can push brushed data\r\nconst selection3 = []; //an empty array where we can push brushed data\r\nconst selection4 = []; //an empty array where we can push brushed data\r\n\r\nfunction removeText() { //remove texts tagged with 'info' class\r\n  d3.selectAll('p.info').remove();\r\n}\r\nfunction removeBrush() { //remove brush selection\r\n selection.length = 0;\r\n}\r\nfunction removeBrush2() { //remove brush selection\r\n  selection3.length = 0;\r\n}\r\nfunction removeBrush3() { //remove brush selection\r\n  selection4.length = 0;\r\n}\r\n/*this doesn't work because selection is empty here, but if I call a function in the onClick that is inside the main function and has values in the array, the function itself returns not defined*/\r\nfunction tableClick() {\r\n  removeText();\r\n  removeBrush();\r\n  removeBrush2();\r\n  removeBrush3();\r\n}\r\n\r\n  /*const [selection, setDataSelection] = useState([])\r\n  function readData(){\r\n    //format d3 data reader for tab separated files, then use setDataRaw\r\n    d3.dsv(\"\\t\", data).then(selection=>{\r\n      //defining new selection\r\n      selection = newSelection\r\n      setDataSelection(newSelection);\r\n    })\r\n    console.log(newSelection);\r\n  }*/\r\n  \r\n  return (\r\n<>\r\n\r\n{/*This structure was for the start screen*/}\r\n{/*<div id=\"start\">\r\n  <div id=\"input-btn-block-start\">\r\n      <input id=\"data-file-start\" type=\"file\" className=\"custom-file-input-start\"/>\r\n  </div>\r\n</div>\r\n\r\n  <div id=\"afterStart\">*/}\r\n\r\n<div style={{\r\n  position: 'relative',\r\n  }}>\r\n\t<div id='btn-block'>\r\n\t\t<div id='btn-block-toggle'>\r\n        \t<button id='button_styled' onClick={()=>tableClick()}>Clear selection</button>\r\n        \t<a><button className=\"button_styled\" id='button_styled_download'>Download table</button></a>\r\n   \t\t</div>\r\n   \t\t<div id='btn-block-2'>\r\n   \t\t\t<button id='button_styled-2' onClick={()=>tableClick()}>Clear selection</button>\r\n        \t<a><button className=\"button_styled\" id='button_styled_download_zoom'>Download table</button></a>\r\n   \t\t</div>\r\n\r\n   \t\t<div id=\"info-column-wrapper\">\r\n   \t\t \t<div  id=\"info-column\">\r\n   \t\t \t\t    <div id=\"category\">\r\n        \t\t\t\t<h5 className=\"h5\" style={{width: '10vw'}}>Category</h5>\r\n    \t\t\t\t</div>\r\n    \t\t\t\t<div id=\"phenotype\">\r\n        \t\t\t\t<h5 className=\"h5\" style={{width: '10vw'}}>Phenotype</h5>\r\n    \t\t\t\t</div>\r\n    \t\t\t\t<div id=\"pval\">\r\n        \t\t\t\t<h5 className=\"h5\" style={{maxWidth: '10vw'}}>P-value</h5>\r\n    \t\t\t\t</div>\r\n    \t\t\t\t<div id=\"beta\">\r\n        \t\t\t\t<h5 className=\"h5\" style={{maxWidth: '10vw'}}>Beta</h5>\r\n    \t\t\t\t</div>\r\n    \t\t\t\t<div id=\"case-control\">\r\n        \t\t\t\t<h5 className=\"h5\" style={{maxWidth: '10vw'}}>Cases/Controls</h5>\r\n  \t\t\t\t\t</div>\r\n   \t\t \t</div>\r\n\r\n\r\n   \t\t \t<div id='labels-block'>\r\n   \t\t \t\t<div id='divider-vertical'></div>\r\n   \t\t \t\t<div id='labels-block-2'>\r\n   \t\t \t\t \t<button id=\"button_legend\">Show legend &rarr;</button>\r\n       \t\t\t\t<button className=\"button_collapse\" id=\"buttonCollapse\">&larr; Collapse</button>\r\n   \t\t \t\t</div>\r\n   \t\t \t</div>\r\n\t\t</div>\r\n\r\n\t</div>\r\n</div>\r\n\r\n\r\n  \t<div id='chart'>\r\n  \t\t<div id='headline-block'>\r\n  \t\t\t<div id='chart-btn-block'>\r\n  \t\t\t\t<div className='chart-btn-container'>\r\n  \t\t\t\t\t<div className='flexbox-checkbox'>\r\n\r\n  \t\t\t\t\t\t<div id='hideThese'>\r\n  \t\t\t\t\t\t\t<div id=\"input-btn-block\">\r\n          \t\t\t\t\t\t\r\n          \t\t\t\t\t</div>\r\n  \t\t\t\t\t\t</div>\r\n\r\n  \t\t\t\t\t\t<button id='button_back'>Go back</button>\r\n\r\n  \t\t\t\t\t\t<div id='ZoomHull'>\r\n              \t\t\t\t<label className='h5'>Convex hulls\r\n                    \t\t\t<input type='checkbox' id='hullCheckboxZoom'/>\r\n                    \t\t\t<span className='checkmark-custom'></span>\r\n              \t\t\t\t</label>\r\n        \t\t\t\t</div>\r\n\r\n        \t\t\t\t<div id='hullCheckboxDiv' style={{marginTop: '1%'}}>\r\n              \t\t\t\t<label className='h5'style={{paddingLeft: '1vw'}}>Convex hulls\r\n                    \t\t\t<input type='checkbox' id='hullCheckbox'/>\r\n                    \t\t\t<span className='checkmark-custom' id='hullCheckMark'></span>\r\n              \t\t\t\t</label>\r\n        \t\t\t\t</div>\r\n\r\n        \t\t\t\t<div id='significanceCheckboxDiv' style={{marginTop: '1%'}}>\r\n              \t\t\t\t<label className='h5' style={{paddingLeft: '4vw'}}>Show significant\r\n                    \t\t\t<input type='checkbox' id='significanceCheckbox'/>\r\n                    \t\t\t<span className='checkmark-custom-2'></span>\r\n              \t\t\t\t</label>\r\n        \t\t\t\t</div>\r\n\r\n        \t\t\t\t<div id='pipCheckboxDiv' style={{marginTop: '1%'}}>\r\n              \t\t\t\t<label className='h5' style={{paddingLeft: '4vw'}}>Show PIP &gt; 0\r\n                    \t\t\t<input type='checkbox' id='pipCheckbox'/>\r\n                    \t\t\t<span className='checkmark-custom-3'></span>\r\n              \t\t\t\t</label>\r\n        \t\t\t\t</div>\r\n\r\n  \t\t\t\t\t</div>\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n\r\n  \t\t<div id='downloadImg-block'>\r\n\t\t\t\t<button id='download' onClick={()=>{downloadImgClick()}}>download image</button>\r\n        <div className='reportIssue'>\r\n          <div className='reportIcon'>?</div>\r\n          <a id=\"report\" href=\"mailto:stella.keppo@aalto.fi?subject=Issue report from LAVAA\" className='h5' style={{paddingLeft:'0.5vw'}}>Report issue</a>\r\n        </div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div id='chartInner'>\r\n      </div>\r\n  \t\t</div> \r\n  \t</div>\r\n\r\n  \t<div id='download-options'>\r\n    \t<div id='download-options-inner'>\r\n    \t\t<a id='downloadSvg' download='LAVAA_volcano.svg'>\r\n      \t\t\t<button className='downloadImgBtn' onClick={()=>hideDownloadOptions()}>svg</button>\r\n    \t\t</a>\r\n    \t\t<a id='downloadJpeg' download='LAVAA_volcano'>\r\n      \t\t\t<button className='downloadImgBtn' onClick={()=>hideDownloadOptions()}>jpeg</button>\r\n    \t\t</a>\r\n    \t\t<button className='close' id='closeBtn' onClick={()=>hideDownloadOptions()}>\r\n      \t\t\t<i className='ico-times' role='img' aria-label='Cancel'></i>\r\n    \t\t</button>\r\n  \t\t</div>\r\n  </div>\r\n\r\n<div id=\"upload-options-background\">\r\n    <div id=\"upload-options\"></div>\r\n</div>\r\n\r\n{/*</div>*/}\r\n{/*after start screen wrap div end*/}\r\n\r\n</>\r\n\r\n);\r\n\r\n} \r\n\r\nexport default Lavaa;"]},"metadata":{},"sourceType":"module"}